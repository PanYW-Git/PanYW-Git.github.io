<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>羊腿外卖开发记录 | PanYw's Blog</title><meta name="author" content="PanYW"><meta name="copyright" content="PanYW"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="教学地址https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV13a411q753?p&#x3D;6&amp;spm_id_from&#x3D;pageDriver&amp;vd_source&#x3D;2497f00c3af066126b298d1871671eec 本次项目中使用到的技术 spring springMVC springboot mybatis-plus mysql Linux lombok fa">
<meta property="og:type" content="article">
<meta property="og:title" content="羊腿外卖开发记录">
<meta property="og:url" content="https://panyw-git.github.io/2023/05/15/%E7%BE%8A%E8%85%BF%E5%A4%96%E5%8D%96%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="PanYw&#39;s Blog">
<meta property="og:description" content="教学地址https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV13a411q753?p&#x3D;6&amp;spm_id_from&#x3D;pageDriver&amp;vd_source&#x3D;2497f00c3af066126b298d1871671eec 本次项目中使用到的技术 spring springMVC springboot mybatis-plus mysql Linux lombok fa">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://panyw-git.github.io/images/touxiang.jpg">
<meta property="article:published_time" content="2023-05-15T01:15:32.000Z">
<meta property="article:modified_time" content="2023-06-09T07:30:00.000Z">
<meta property="article:author" content="PanYW">
<meta property="article:tag" content="mybatis-plus">
<meta property="article:tag" content="springboot">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="vue2">
<meta property="article:tag" content="ajax">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://panyw-git.github.io/images/touxiang.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://panyw-git.github.io/2023/05/15/%E7%BE%8A%E8%85%BF%E5%A4%96%E5%8D%96%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '羊腿外卖开发记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-09 15:30:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="PanYw's Blog"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/logo-234x64.png"/><span class="site-name">PanYw's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">羊腿外卖开发记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-15T01:15:32.000Z" title="发表于 2023-05-15 09:15:32">2023-05-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-09T07:30:00.000Z" title="更新于 2023-06-09 15:30:00">2023-06-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/">项目实践</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>79分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="羊腿外卖开发记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="教学地址"><a href="#教学地址" class="headerlink" title="教学地址"></a>教学地址</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13a411q753?p=6&spm_id_from=pageDriver&vd_source=2497f00c3af066126b298d1871671eec">https://www.bilibili.com/video/BV13a411q753?p=6&amp;spm_id_from=pageDriver&amp;vd_source=2497f00c3af066126b298d1871671eec</a></p>
<h1 id="本次项目中使用到的技术"><a href="#本次项目中使用到的技术" class="headerlink" title="本次项目中使用到的技术"></a>本次项目中使用到的技术</h1><ul>
<li>spring</li>
<li>springMVC</li>
<li>springboot</li>
<li>mybatis-plus</li>
<li>mysql</li>
<li>Linux</li>
<li>lombok</li>
<li>fastjson</li>
<li>druid</li>
<li>mysql</li>
<li>vue2</li>
<li>ElementUI</li>
<li>ajax</li>
<li>commons-email</li>
<li>tencentcloud-sdk-java</li>
</ul>
<h1 id="项目前言（放在这儿！必看！）"><a href="#项目前言（放在这儿！必看！）" class="headerlink" title="项目前言（放在这儿！必看！）"></a>项目前言（放在这儿！必看！）</h1><ul>
<li>教程中的业务逻辑都是写在controller层中的，本次代码按照规范把controller中的业务逻辑都放在了service层中方便其他controller复用</li>
<li>提供的pojo中没有写逻辑删除，但是提供的数据表中保留了逻辑删除字段，本次开发过程中增加逻辑删除功能</li>
<li>在开发前了解了代码整体结构，发现本项目使用的测试类较少，本次开发中尽量使用测试类测试代码，但本次以练习springboot+mybatis-plus练手为目的，这一步有部分省略。</li>
<li>教程中含有部分教学知识，部分模块使用教学新知识+代码编写的方式进行教学，根据目录看所教知识并不深如Redis，后续还需要通过其他教程学习。</li>
<li>开发按照模块根据业务需求先自己思考编写代码，然后再回顾教程，以加深印象</li>
<li>了解提供的前端源码、顺便替换了logo和部分样式、修改了前端登录成功后返回登录页面登录按钮还是“登陆中…”的bug</li>
</ul>
<h1 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h1><ol>
<li>项目其实主要还是CRUD的操作，基本上不用mapper.xml，这也是针对mybatis-plus的练习吧，项目还是以练习springboot+mybatis的CRUD为主，适合刚刚学完SpringMVC+springboot来练练手，刚开始做的几个模块还要跟着教程一个一个做，熟练了之后后面的模块大部分都是自己开发，昨完再看看教程看下有一些业务逻辑是不是遗漏的，这个项目做完CRUD肯定没问题了，但是sql还需要锻炼</li>
<li>这个项目主要是在后端，可以不用纠结与前端的一些代码，我就有时候看看前端修修改改其实挺费时的，因为一些语法或者是前端的代码对于我学后端的来说没那么熟悉</li>
<li>粗略看了下后面的redis等课程都是一些入门的操作，其实还是觉得应该系统学一下，就不看这个项目的来学习了</li>
</ol>
<h1 id="一点小惊喜"><a href="#一点小惊喜" class="headerlink" title="一点小惊喜"></a>一点小惊喜</h1><ul>
<li>本文章被CSDN-AI翻牌子了</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/08/15/1OrKsQ7o389gTjb.png" alt="在这里插入图片描述"></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/08/15/TAN9RKn8LJjMU2f.png" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/08/15/emQnYZThWSOlK8r.png" alt="在这里插入图片描述"></p>
<h1 id="项目开发记录"><a href="#项目开发记录" class="headerlink" title="项目开发记录"></a>项目开发记录</h1><h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><ul>
<li>创建一个springboot项目gigot_takeaway，勾选勾选Spring Web，MySQL和MyBatis，然后在pom.xml中导入druid，lombok和MyBatisPlus的坐标；导入前端文件和数据库表</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>将前端文件backend、front放行。注：可通过放在static目录下让资源自动放心，看弹幕说放static后续可能出现bug所以和教程保持一致</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源放行路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/backend/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/front/&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;静态资源放行成功...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建分类包，mapper、pojo、service、controller等完成项目框架搭建，并使用mp（mybatis-plus后续简称）的内置类，将service，serviceImpl继承相应方法，会自动生成selectAll等常用方法</li>
<li>创建通用的返回响应体类R，类包括code（返回状态编码）、msg（返回信息）、data（封装json属性）、map（封装动态对象）四个属性，并在其中增加两个三个静态方法用于设置上述四个属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：1成功，0和其它数字为失败</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//动态数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、后台系统登录功能"><a href="#二、后台系统登录功能" class="headerlink" title="二、后台系统登录功能"></a>二、后台系统登录功能</h2><h3 id="1-用户登录"><a href="#1-用户登录" class="headerlink" title="1. 用户登录"></a>1. 用户登录</h3><h4 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h4><ol>
<li>将用户输入的密码进行md5加密处理</li>
<li>根据username查询数据库</li>
<li>如果没有查询到则返回登录失败结果</li>
<li>判断密码</li>
<li>判断用户是否被禁用</li>
<li>id存入session</li>
<li>通过封装类型R返回前台</li>
<li>编写测试类测试以上功能</li>
<li>完成前端到后端测试</li>
</ol>
<p>ps：教程中是在controller中书写的，service层到controller层如何使用统一封装类并且传入session查阅了很多资料，没办法找了chatgpt问了下，是这样回复<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/bb01c3b191a24693911a1a32db49ed2b.png" alt="在这里插入图片描述"></p>
<h4 id="业务逻辑代码"><a href="#业务逻辑代码" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.common.R;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.pojo.Employee;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EmployeeMapper, Employee&gt; <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">        <span class="comment">//将密码进行md5加密处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword();</span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line">        <span class="comment">//根据username查询数据库</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Employee::getUsername,employee.getUsername());</span><br><span class="line">        <span class="comment">//注：用户名在数据库中有唯一约束</span></span><br><span class="line">        employee = employeeMapper.selectOne(queryWrapper);</span><br><span class="line">        <span class="comment">//如果没有查询到则返回登录失败结果</span></span><br><span class="line">        <span class="keyword">if</span>(employee == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;用户名或密码错误，请重新输入！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断密码</span></span><br><span class="line">        <span class="keyword">if</span>(!employee.getPassword().equals(password)) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;用户名或密码错误，请重新输入！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断用户是否被禁用</span></span><br><span class="line">        <span class="keyword">if</span>(employee.getStatus() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;该用户已被冻结，请联系系统管理员&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//id存入session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;employee&quot;</span>,employee.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="登录功能前端页面分析"><a href="#登录功能前端页面分析" class="headerlink" title="登录功能前端页面分析"></a>登录功能前端页面分析</h4><p>采用内嵌窗的方式，每一个标签栏对应一个地址，如果需要增加或修改可以直接修改这一块，具体可以看代码中的iframeUrl模型，了解实现方式<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/4c61d0464d0d402c8f8afb7eaed507c9.png" alt="![在这里插入图片描述](https://img-blog.csdnimg.cn/c800ab2e13e9438f97f8905ecf5c1958.png"></p>
<h3 id="2-退出登录功能"><a href="#2-退出登录功能" class="headerlink" title="2. 退出登录功能"></a>2. 退出登录功能</h3><h4 id="功能分析-1"><a href="#功能分析-1" class="headerlink" title="功能分析"></a>功能分析</h4><ol>
<li>删除用户session</li>
<li>向前端返回删除成功，由前端跳转页面</li>
</ol>
<h4 id="业务逻辑代码-1"><a href="#业务逻辑代码-1" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退出登录功能实现、清理Session中的用户id，返回结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="comment">//清理session保存的登录id</span></span><br><span class="line">    request.getSession().removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;退出登录成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-登录拦截器"><a href="#3-登录拦截器" class="headerlink" title="3. 登录拦截器"></a>3. 登录拦截器</h3><h4 id="功能分析-2"><a href="#功能分析-2" class="headerlink" title="功能分析"></a>功能分析</h4><ol>
<li>创建一个拦截器，忘了看这儿<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13a411q753?p=16&vd_source=2497f00c3af066126b298d1871671eec">https://www.bilibili.com/video/BV13a411q753?p=16&amp;vd_source=2497f00c3af066126b298d1871671eec</a></li>
<li>拦截所有资源并排除登录及静态资源相关地址</li>
<li>使用AntPathMatcher工具类路径匹配器，支持通配符的方式匹配，如果有上述地址放行</li>
<li>判断用户是否已登录，已登录放行</li>
<li>封装对象给前端，因前端的需求，因此使用输出流的方式传给前端一个R封装对象</li>
</ol>
<h4 id="业务逻辑代码-2"><a href="#业务逻辑代码-2" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.common.R;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.AntPathMatcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查用户是否完成登录，登录后放行资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="comment">//路径匹配器，支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        log.info(<span class="string">&quot;当前拦截到的请求：&#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class="line">        <span class="comment">//定义排除登录相关功能地址和静态资源相关地址</span></span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//判断本次请求是否在上面需要排除的地址中,如果在放行</span></span><br><span class="line">        <span class="keyword">if</span>(check(urls,request.getRequestURI()))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;用户访问登录或相关静态资源地址放行资源&quot;</span>);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断用户是否已登录，已登录放行</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;&#123;&#125;已登录，放行资源&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//前端需求代码中有拦截器，因此这这儿使用输出流的方式传给前端一个R封装对象</span></span><br><span class="line">        log.info(<span class="string">&quot;用户未登录返回前台，前端进行地址跳转&quot;</span>);</span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 路径匹配，用于排除登录相关资源的校验方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls,String requestUri)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="comment">//PATH_MATCHER.match(url,requestUri)方法，用于判断两个地址是否匹配，并且支持通配符的格式，如果匹配商返回true，否则返回false</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> PATH_MATCHER.match(url,requestUri);</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4-新增员工"><a href="#4-新增员工" class="headerlink" title="4. 新增员工"></a>4. 新增员工</h3><h4 id="功能分析-3"><a href="#功能分析-3" class="headerlink" title="功能分析"></a>功能分析</h4><ol>
<li>获取前端用户输入的数据</li>
<li>重写mp的save方法，增加默认密码（从yml中获取）、创建人（从session中获取）、创建时间、修改人、修改时间</li>
<li>封装R给前端</li>
</ol>
<h4 id="业务逻辑代码-3"><a href="#业务逻辑代码-3" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Employee entity)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;&quot;</span>+entity);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">getLoginId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    entity.setPassword(DigestUtils.md5DigestAsHex(defalutPassword.getBytes()));</span><br><span class="line">    entity.setCreateUser(getLoginId);</span><br><span class="line">    entity.setCreateTime(LocalDateTime.now());</span><br><span class="line">    entity.setUpdateUser(getLoginId);</span><br><span class="line">    entity.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.save(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-全局异常处理器"><a href="#5-全局异常处理器" class="headerlink" title="5. 全局异常处理器"></a>5. 全局异常处理器</h3><h4 id="用户名重复报错处理"><a href="#用户名重复报错处理" class="headerlink" title="用户名重复报错处理"></a>用户名重复报错处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLIntegrityConstraintViolationException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常处理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line">        <span class="keyword">if</span>(ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">//根据空格分割开异常</span></span><br><span class="line">            String[] split = ex.getMessage().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="comment">//Duplicate entry &#x27;pyw&#x27; for key &#x27;employee.idx_username&#x27; 获取第三位的名称，并返回给前端，其他错误则抛给用户~</span></span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;该用户&quot;</span>+split[<span class="number">2</span>]+<span class="string">&quot;已存在，请换一个账号名称吧~&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;服务器处理异常，请再试一次~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="6-员工信息分页查询"><a href="#6-员工信息分页查询" class="headerlink" title="6. 员工信息分页查询"></a>6. 员工信息分页查询</h3><h4 id="功能分析-4"><a href="#功能分析-4" class="headerlink" title="功能分析"></a>功能分析</h4><ol>
<li>接收前端传输的页码，分页大小，查询条件</li>
<li>接收前端信息并传入MP的Page类中交给MP存储</li>
<li>增加条件语句，并进行判断输入的条件是否为空，如果为空不增加此条件</li>
<li>获取分页数据</li>
<li>返回封装对象R把分页对象给前端</li>
</ol>
<h4 id="业务逻辑代码-4"><a href="#业务逻辑代码-4" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">selectPage</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;接收到的分页信息page:&#123;&#125; pagesize:&#123;&#125; name:&#123;&#125;&quot;</span>,page,pageSize,name);</span><br><span class="line">    <span class="type">Page</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page,pageSize);</span><br><span class="line">    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    <span class="comment">//添加条件，如果name为空则不添加条件</span></span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);</span><br><span class="line">    <span class="comment">//获取分页数据,此方法会根据MP的IPage类自动封装数据给pageInfo，不需要重新取值</span></span><br><span class="line">    employeeMapper.selectPage(pageInfo,queryWrapper);</span><br><span class="line">    <span class="comment">//返回数据给 前端名称：records 总数total</span></span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setEmployeeServiceSelectPageTest</span><span class="params">()</span>&#123;</span><br><span class="line">    log.info(employeeService.selectPage(<span class="number">1</span>,<span class="number">10</span>,<span class="literal">null</span>)+<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解决问题记录"><a href="#解决问题记录" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><p> <strong>- 混淆了IPage和Page的作用，Page对象通过selectPage()方法调用后会自动通过IPage类进行封装，不需要再赋值了</strong><br>IPage和Page的区别链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_56231256/article/details/121503526">https://blog.csdn.net/m0_56231256/article/details/121503526</a></p>
<h3 id="7-员工账号禁用、启用"><a href="#7-员工账号禁用、启用" class="headerlink" title="7. 员工账号禁用、启用"></a>7. 员工账号禁用、启用</h3><h4 id="功能分析-5"><a href="#功能分析-5" class="headerlink" title="功能分析"></a>功能分析</h4><p>1、后端接收前端修改的账号id和<strong>修改后</strong>的状态<br>2、重写MP的updateById方法，将修改用户、修改时间存入实体类中<br>3、封装对象给前端</p>
<h4 id="业务逻辑代码-5"><a href="#业务逻辑代码-5" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(Employee entity)</span> &#123;</span><br><span class="line">    entity.setUpdateUser(GetSessionUtil.getEmployeeIdForSession(request));</span><br><span class="line">    entity.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.updateById(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录（非常非常重要！！！）"><a href="#解决问题记录（非常非常重要！！！）" class="headerlink" title="解决问题记录（非常非常重要！！！）"></a>解决问题记录（非常非常重要！！！）</h4><ul>
<li>后端Long传输给前端JS如果位数过长会造成精度丢失<br> 实例在var中存储1407898335821492226显示结果如下后两位精度丢失：<br> [inscode(embedurl-<a target="_blank" rel="noopener" href="https://inscode.csdn.net/@qq_19780865/HTML-CSS-JS/embed)(id-iprj6465feea3ee7052dd97150ea)]">https://inscode.csdn.net/@qq_19780865/HTML-CSS-JS/embed)(id-iprj6465feea3ee7052dd97150ea)]</a><br>解决方案（了解即可，复制粘贴）：<br>1、导入JacksonObjectMapper<br> 2、在WebMvcConfig添加以下方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展mvc框架的消息转换器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;扩展消息转换器...&quot;</span>);</span><br><span class="line">    <span class="comment">//创建消息转换器对象</span></span><br><span class="line">    <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">    <span class="comment">//设置对象转换器，底层使用Jackson将Java对象转为json</span></span><br><span class="line">    messageConverter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">    <span class="comment">//将上面的消息转换器对象追加到mvc框架的转换器集合中.并优先级设置为最高</span></span><br><span class="line">    converters.add(<span class="number">0</span>,messageConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>由于程序中多处使用了获取前端当前登录Session，在这儿写了一个工具类用于获取，降低耦合度（不过一个人的项目也没那么多需要修改的了，只是想到了就优化一下）</li>
</ul>
<h3 id="8-修改员工信息"><a href="#8-修改员工信息" class="headerlink" title="8. 修改员工信息"></a>8. 修改员工信息</h3><h4 id="功能分析-6"><a href="#功能分析-6" class="headerlink" title="功能分析"></a>功能分析</h4><ul>
<li>获取前端传输过来的ID，查询出数据返回给前端</li>
<li>获取前端修改的信息，调用员工账号禁用、启用中的updateById方法修改数据到数据库中</li>
</ul>
<h4 id="业务逻辑代码-6"><a href="#业务逻辑代码-6" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller层直接调用mp的getById</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;获取到的前台id：&#123;&#125;&quot;</span>,id);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> employee != <span class="literal">null</span> ? R.success(employee) : R.error(<span class="string">&quot;加载数据失败，请再试一次~&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-公共字段自动填充"><a href="#9-公共字段自动填充" class="headerlink" title="9. 公共字段自动填充"></a>9. 公共字段自动填充</h3><h4 id="功能分析-7"><a href="#功能分析-7" class="headerlink" title="功能分析"></a>功能分析</h4><p>  背景：因业务需求部分字段在插入，或更新时需要重复处理，造成代码高耦合度，后期运维困难，所以需要解决此问题</p>
<ol>
<li>创建类MyMetaObjectHandler实现MP的MetaObjectHandler接口，复写insertFill（插入时设置字段值）和updateFill（更新时设置字段值）</li>
<li>在需要处理的实体类字段上增加@TableField(fill &#x3D; FieldFill.INSERT_UPDATE)<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/1c363478c59e4025b9956d9ffa198228.png" alt="(https://img-blog.csdnimg.cn/3f39482222b548d3bba166801378b59f.png)"></li>
</ol>
<ul>
<li>注：获取前端Session，自动存储到创建人，更新人字段<br> 但无法通过HttpSession获取Session对象，需要从线程中获取<br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/8f3fdab062c945c3b56f092eccecf8ca.png" alt="在这里插入图片描述"></li>
</ul>
<ol start="3">
<li>编写BaseContext工具类，基于ThreadLocal封装工具类</li>
<li>在登录拦截器中调用BaseContext来设置当前登录用户的id</li>
<li>在MyMetaObjectHandler调用BaseContext获取用户的id</li>
<li>删除insert，update相关方法中的创建人、创建时间、更新人、更新时间</li>
</ol>
<h4 id="业务逻辑代码-7"><a href="#业务逻辑代码-7" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.util.BaseContextUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 公共字段填充（自定义元数据对象处理器）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;公共字段自动填充[insert]...&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;&quot;</span>+LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>, BaseContextUtil.getThreadLocal());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, BaseContextUtil.getThreadLocal());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;公共字段自动填充[update]...&quot;</span>);</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,BaseContextUtil.getThreadLocal());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录-1"><a href="#解决问题记录-1" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><p>提供的实体类Employee里面只有创建人、更新人写了@TableField注解、创建时间、更新时间没写，记得加！找了好久的错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Long updateUser;</span><br></pre></td></tr></table></figure>
<h3 id="10-分类管理新增功能"><a href="#10-分类管理新增功能" class="headerlink" title="10. 分类管理新增功能"></a>10. 分类管理新增功能</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输数据</li>
<li>使用MP封装的save方法存储数据</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-8"><a href="#业务逻辑代码-8" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping()</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;新增分类&#123;&#125;&quot;</span>,category);</span><br><span class="line">    <span class="keyword">return</span> categoryService.save(category)? R.success(<span class="string">&quot;创建成功&quot;</span>): R.error(<span class="string">&quot;新增失败，请再试一次&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-分类管理分页查询功能"><a href="#11-分类管理分页查询功能" class="headerlink" title="11. 分类管理分页查询功能"></a>11. 分类管理分页查询功能</h3><h4 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输的当前页码，显示最大数</li>
<li>使用MP分页类封装对象，并根据排序字段排序</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-9"><a href="#业务逻辑代码-9" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">selectPage</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize)</span>&#123;</span><br><span class="line">    Page&lt;Category&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>(page,pageSize);</span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//从小到大排序</span></span><br><span class="line">    queryWrapper.orderByAsc(Category::getSort);</span><br><span class="line">    pageInfo = categoryMapper.selectPage(pageInfo,queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-分类管理删除功能"><a href="#12-分类管理删除功能" class="headerlink" title="12. 分类管理删除功能"></a>12. 分类管理删除功能</h3><h4 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h4><p>1、接收前端传回来的id<br>2、校验当前分类是否在菜品或套餐中有关联数据，如果抛出运行时异常，并返回前端，如果没有则封装对象R返回给前端<br>注：因为使用到了菜品和套餐两张数据表，需要导入实体类以及相应的mapper和service，嫌麻烦这次把所有实体类一起导入到了本项目中</p>
<h4 id="业务逻辑代码-10"><a href="#业务逻辑代码-10" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>自定义异常类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>全局异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 运行时异常处理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(CustomException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(CustomException ex)</span>&#123;</span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> R.error(ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">removeById</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">    <span class="comment">//查询当前分类是否关联了菜品，如果已经关联，抛出一个业务异常</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; dishQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    dishQueryWrapper.eq(Dish::getCategoryId,id);</span><br><span class="line">    <span class="keyword">if</span>(dishService.count(dishQueryWrapper) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;删除分类与菜品关联&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下关联了菜品，不允许删除!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询当前分类是否关联了套餐，如果已经关联，抛出一个业务异常</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; SetmealQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    SetmealQueryWrapper.eq(Setmeal::getCategoryId,id);</span><br><span class="line">    <span class="keyword">if</span>(setmealService.count(SetmealQueryWrapper) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;删除分类与套餐关联&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下关联了套餐，不允许删除!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果都没有关联，则正常删除分类</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.removeById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录-2"><a href="#解决问题记录-2" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><p>1、教程中使用的是id，而实体提供的代码提供的是ids，注意接收参数<br>2、注意区分把<strong>参数作为请求体</strong>*的一部分还是<strong>参数作为路径</strong>的一部分<br><strong>参数作为请求体接收参数</strong><br><a target="_blank" rel="noopener" href="http://localhost/category/1659817228414709761">http://localhost/category/1659817228414709761</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;ids&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">deleteById</span><span class="params">(<span class="meta">@PathVariable</span> Long ids)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除分类数据&#123;&#125;&quot;</span>,ids);</span><br><span class="line">    <span class="keyword">return</span> categoryService.removeById(ids)? R.success(<span class="string">&quot;已成功删除一条数据~&quot;</span>) : R.error(<span class="string">&quot;删除失败，请再试一次&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>参数作为路径</strong><br><a target="_blank" rel="noopener" href="http://localhost/category?ids=1659817228414709761">http://localhost/category?ids=1659817228414709761</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;ids&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">deleteById</span><span class="params">(<span class="meta">@PathVariable</span> Long ids)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除分类数据&#123;&#125;&quot;</span>,ids);</span><br><span class="line">    <span class="keyword">return</span> categoryService.removeById(ids)? R.success(<span class="string">&quot;已成功删除一条数据~&quot;</span>) : R.error(<span class="string">&quot;删除失败，请再试一次&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.在service中多写了一个@Autowired，抛异常没有找到selectPage的int参数，找了半天错误，下次写的时候得注意一行一行写</p>
<h3 id="13-分类管理修改功能"><a href="#13-分类管理修改功能" class="headerlink" title="13. 分类管理修改功能"></a>13. 分类管理修改功能</h3><h4 id="功能分析-8"><a href="#功能分析-8" class="headerlink" title="功能分析"></a>功能分析</h4><p>1、获取前端修改的信息，调用MP的updateById方法修改数据到数据库中<br>注：前端数据存储再模型中，不需要从数据库查询再到前端</p>
<h4 id="业务逻辑代码-11"><a href="#业务逻辑代码-11" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping()</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;更新分类数据&#123;&#125;&quot;</span>,category);</span><br><span class="line">        categoryService.updateById(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;已成功更新一条数据~&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-文件上传"><a href="#14-文件上传" class="headerlink" title="14. 文件上传"></a>14. 文件上传</h3><h4 id="需求分析-3"><a href="#需求分析-3" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端传输的文件信息，使用spring框架的MultipartFile类进行接收（前端传输的也是这个对象），因文件传输可能在多个模块使用，因此单独定义一个Controller进行文件的上传和下载</li>
<li>用户传输的文件名可能重复，因此需要根据一个随机且不重复（UUid）的数据进行重命名</li>
<li>在项目启动时校验存储上传文件的文件夹upload是否存在，不存在则创建文件夹（<em><strong>注：此方法与教程有差异，考虑到每次上传图片都需要校验文件是否存在，会影响效率，所以在这个地方重写springboot的ApplicationRunner接口用于在项目启动时创建</strong></em>）</li>
<li>存储文件到服务器</li>
<li>封装对象R返回前端上传文件的路径（前端需要显示该图片）</li>
</ol>
<h5 id="业务逻辑代码-12"><a href="#业务逻辑代码-12" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h5><ol>
<li>CommonServiceImpl</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="comment">//获取文件后缀名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFileName.substring(originalFileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用uuid重新生成文件名，防止文件名称重复造成文件覆盖</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;</span><br><span class="line">        log.info(<span class="string">&quot;上传文件的原始图片文件名为：&#123;&#125;  根据UUid生成的文件名为：&#123;&#125;&quot;</span>,originalFileName,fileName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        校验文件夹是否存在，放在项目启动时创建目录</span></span><br><span class="line"><span class="comment">//        File dir = new File(filePath);</span></span><br><span class="line"><span class="comment">//        if(!dir.exists())&#123;</span></span><br><span class="line"><span class="comment">//            dir.mkdir();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//获取绝对路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">absolutePath</span> <span class="operator">=</span> GetAbsolutePathUtil.getAbsolutePathUtil(filePath);</span><br><span class="line">        <span class="comment">//存储文件到服务器</span></span><br><span class="line">        <span class="comment">/*File.separator 是一个与操作系统相关的文件分隔符。它是一个字符串常量，用于表示文件路径中的分隔符。</span></span><br><span class="line"><span class="comment">         *在 Windows 系统上，File.separator 的值是反斜杠 \，例如 &quot;C:\Users\Username\Documents\file.txt&quot;。</span></span><br><span class="line"><span class="comment">         *而在类 Unix 或 Linux 系统上，File.separator 的值是正斜杠 /，例如 &quot;/home/username/documents/file.txt&quot;。</span></span><br><span class="line"><span class="comment">         *使用 File.separator 可以确保在不同操作系统上正确构建文件路径，以便代码在不同平台上都能正常运行。</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        log.info(<span class="string">&quot;上传文件存储完整路径为：&#123;&#125;&quot;</span>,absolutePath.toString()+File.separator+fileName);</span><br><span class="line">        file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(absolutePath.toString()+File.separator+fileName));</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在项目启动时校验上传文件的文件夹是否存在进行校验</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.runner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Initializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;takeout.filePath&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String filePath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始初始化系统配置......&quot;</span>);</span><br><span class="line">        <span class="comment">//初始化文件上传保存路径校验</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            dir.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">basePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;&quot;</span>); <span class="comment">// 默认为当前工作目录</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">absolutePath</span> <span class="operator">=</span> basePath.resolve(filePath).toAbsolutePath();</span><br><span class="line">        log.info(<span class="string">&quot;初始化文件上传保存路径成功，地址为:&#123;&#125;&quot;</span>,absolutePath.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录-3"><a href="#解决问题记录-3" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><ol>
<li>实现ApplicationRunner接口时需要在实现类加上@Component，让他成为一个bean才能被spring所操控</li>
</ol>
<h3 id="15-文件下载"><a href="#15-文件下载" class="headerlink" title="15. 文件下载"></a>15. 文件下载</h3><h4 id="需求分析-4"><a href="#需求分析-4" class="headerlink" title="需求分析"></a>需求分析</h4><ol start="2">
<li>接收前端传输的文件名</li>
<li>根据前端提供的文件名通过输入流的方式从本地读取文件</li>
<li>定义响应头</li>
<li>将本地文件读取输入流，传入响应输出流返回前端</li>
<li>关闭输入流和输出流<br> <em><strong>注：因为通过流的方式返回给前端不需要返回值</strong></em></li>
</ol>
<h4 id="业务逻辑代码-13"><a href="#业务逻辑代码-13" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller(因本次操作都是对请求和响应操作，不需要放到service中)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件下载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String name, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    log.info(<span class="string">&quot;下载文件,接收到的前端数据为&#123;&#125;&quot;</span>,name);</span><br><span class="line">    <span class="type">String</span> <span class="variable">absolutePath</span> <span class="operator">=</span> GetAbsolutePathUtil.getAbsolutePathUtil(filePath);</span><br><span class="line">    <span class="comment">//输入流，通过输入流读取文件内容</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(absolutePath+File.separator+name));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出流，输出文件返回给前端</span></span><br><span class="line">    <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> resp.getOutputStream();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置响应时一个image文件</span></span><br><span class="line">    resp.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">        outputStream.write(bytes,<span class="number">0</span>,len);</span><br><span class="line">        outputStream.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭资源</span></span><br><span class="line">    fileInputStream.close();</span><br><span class="line">    outputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16-菜品管理分页查询"><a href="#16-菜品管理分页查询" class="headerlink" title="16. 菜品管理分页查询"></a>16. 菜品管理分页查询</h3><h4 id="需求分析-5"><a href="#需求分析-5" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输的分页信息和查询信息</li>
<li>根据排序字段、更新时间字段排序并增加按照菜品名称条件查询</li>
<li>因前端分类名称来源于分类数据表（Category），需建立Dto存储分类名称字段传输前端</li>
<li>把Page&lt;Dish&gt;的属性值拷贝到Page&lt;DishDto&gt;,并排除records</li>
<li>将dish的值存入dishDto并根据categoryId查询name分类名称</li>
<li>设置dishDtoPage的records属性（传输的实际数据属性）</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-14"><a href="#业务逻辑代码-14" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DishFlavorService dishFlavorService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line">CategoryService categoryService;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">selectPage</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize,String name)</span> &#123;</span><br><span class="line">    Page&lt;Dish&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>(page,pageSize);</span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.orderByDesc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line">    qw.eq(StringUtils.isNotEmpty(name),Dish::getName,name);</span><br><span class="line">    dishMapper.selectPage(pageInfo,qw);</span><br><span class="line">    log.info(<span class="string">&quot;获取到的total为：&#123;&#125;&quot;</span>,pageInfo);</span><br><span class="line">    <span class="comment">//使用与前端交互的类DishDto ,把pageInfo拷贝到dishDtoPage</span></span><br><span class="line">    Page&lt;DishDto&gt; dishDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">    <span class="comment">//复制Dish对象的属性到DishDto对象，排除records属性（传输的实际数据属性）</span></span><br><span class="line">    BeanUtils.copyProperties(pageInfo,dishDtoPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line">    <span class="comment">//1、获取Page中的数据列表</span></span><br><span class="line">    List&lt;Dish&gt; dishList = pageInfo.getRecords();</span><br><span class="line">    <span class="comment">//2、定义一个新的数组，用于存入Dto</span></span><br><span class="line">    List&lt;DishDto&gt; dishDtoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//将dish的值存入dishDto并根据categoryId查询name分类名称</span></span><br><span class="line">    <span class="keyword">for</span> (Dish dish : dishList) &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        <span class="comment">// 复制Dish对象的属性到DishDto对象</span></span><br><span class="line">        BeanUtils.copyProperties(dish,dishDto);</span><br><span class="line">        <span class="comment">//根据菜品分类ID查询name</span></span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(dish.getCategoryId());</span><br><span class="line">        <span class="comment">//设置dishDto的CategoryName属性</span></span><br><span class="line">        dishDto.setCategoryName(category.getName());</span><br><span class="line">        <span class="comment">//将dishDto放到dishDtoList集合中</span></span><br><span class="line">        dishDtoList.add(dishDto);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置dishDtoPage的records属性（传输的实际数据属性）</span></span><br><span class="line">    dishDtoPage.setRecords(dishDtoList);</span><br><span class="line">    <span class="keyword">return</span> R.success(dishDtoPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录-4"><a href="#解决问题记录-4" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><ol>
<li>如果再ServiceImplA导入ServiceB，再ServiceImplB导入ServiceA会触发spring的依赖循环，spring不允许依赖循环，因此需要在根据类型自动注入@Autowired下增加@Lazy</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/02843d086b8a4356ad88d88494a7ce0a.png" alt="在这里插入图片描述"></li>
</ol>
<h3 id="17-菜品管理保存数据"><a href="#17-菜品管理保存数据" class="headerlink" title="17. 菜品管理保存数据"></a>17. 菜品管理保存数据</h3><h4 id="需求分析-6"><a href="#需求分析-6" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输数据，因数据中有口味（DishFlavor）接收请求体数据封装为DishDto</li>
<li>保存菜品分类（Dish）数据（DishDto继承至Dish，可通过MP的service的save方法直接保存）</li>
<li>根据DishDto得到id，dishFlavors为集合，设置数据的所有的DishId为Dish类的ID（一对多主子表关系）</li>
<li>调用dishFlavorService存储前端传输的dishFlavors集合</li>
<li>因同时操作两张表，需要给次方法加上事务保证数据同事插入</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-15"><a href="#业务逻辑代码-15" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">    <span class="comment">//保存菜品的基本信息到菜品表dish</span></span><br><span class="line">    <span class="built_in">this</span>.save(dishDto);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dishDto.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品口味</span></span><br><span class="line">    List&lt;DishFlavor&gt; dishFlavors = dishDto.getFlavors();</span><br><span class="line">    <span class="keyword">for</span> (DishFlavor dishFlavor : dishFlavors) &#123;</span><br><span class="line">        dishFlavor.setDishId(dishId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dishFlavorService.saveBatch(dishFlavors);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新增成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="18-菜品管理修改数据"><a href="#18-菜品管理修改数据" class="headerlink" title="18. 菜品管理修改数据"></a>18. 菜品管理修改数据</h3><h4 id="需求分析-7"><a href="#需求分析-7" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>根据前端传输的id查询菜品、口味、分类信息</li>
<li>调用service的getbyid方法直接查询菜品信息</li>
<li>创建集合dishFlavors</li>
<li>查询口味表并将结果dishFlavors放入dishDto类中</li>
<li>分类表已实现，可以直接调用不重复说明</li>
<li>封装对象R&lt;DishDto&gt;给前端</li>
<li>接收前端修改信息使用DishDto接收数据，包含菜品和口味信息</li>
<li>调用service的updatebyid方法更改dish表数据</li>
<li>删除与本次菜品表相关的口味数据，再将前端传输的口味集合插入到数据库中<br> 10.封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-16"><a href="#业务逻辑代码-16" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询菜品信息和口味信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//查询菜品信息</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">    <span class="comment">//对象拷贝</span></span><br><span class="line">    <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">    BeanUtils.copyProperties(dish,dishDto);</span><br><span class="line">    <span class="comment">//查询口味表</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.eq(DishFlavor::getDishId,dish.getId());</span><br><span class="line">    List&lt;DishFlavor&gt; dishFlavors = dishFlavorService.list(qw);</span><br><span class="line">    dishDto.setFlavors(dishFlavors);</span><br><span class="line">    <span class="keyword">return</span> dishDto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改菜品</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.updateById(dishDto);</span><br><span class="line">    <span class="comment">//先删除口味数据，再重新添加口味数据</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.eq(DishFlavor::getDishId,dishDto.getId());</span><br><span class="line">    dishFlavorService.remove(qw);</span><br><span class="line">    List&lt;DishFlavor&gt; dishDtoFlavors = dishDto.getFlavors();</span><br><span class="line">    <span class="keyword">for</span> (DishFlavor dishDtoFlavor : dishDtoFlavors) &#123;</span><br><span class="line">        dishDtoFlavor.setDishId(dishDto.getId());</span><br><span class="line">    &#125;</span><br><span class="line">    dishFlavorService.saveBatch(dishDto.getFlavors());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="19-批量起售、批量停售"><a href="#19-批量起售、批量停售" class="headerlink" title="19. 批量起售、批量停售"></a>19. 批量起售、批量停售</h3><h4 id="需求分析-8"><a href="#需求分析-8" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端数据</li>
<li>因返回的数据为id集合，新增DishMapper.xml使用xml的方式编写sql（如果使用MP可以使用循环的方式来update），也可以使用Lamda表达式，为了复习下Mapper.xml顺便就用这种方式写了</li>
<li>封装对象R返回前端<br> 注：批量启用和启用传输的请求是同一个，不需要重复写一个单独启用功能</li>
</ol>
<h4 id="业务逻辑代码-17"><a href="#业务逻辑代码-17" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量启售，批量停售</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(<span class="type">int</span> status, List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">updateCount</span> <span class="operator">=</span> dishMapper.updateStatusByIds(status,ids);</span><br><span class="line">    log.info(<span class="string">&quot;成功更新&#123;&#125;条数据&quot;</span>,updateCount);</span><br><span class="line">    <span class="keyword">return</span> updateCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DishMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.gigottakeaway.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStatusByIds&quot;</span>&gt;</span></span><br><span class="line">        update dish</span><br><span class="line">        set status = #&#123;status&#125;</span><br><span class="line">        where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        ;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="问题解决记录"><a href="#问题解决记录" class="headerlink" title="问题解决记录"></a>问题解决记录</h4><ul>
<li>前端传输了status和ids集合，传输的格式为&#x2F;status&#x2F;1?ids&#x3D;123456789，并且数据在url上，不在请求体中，因此controller接收需要使用@PathVariable int status ,@RequestParam List<Long> ids</li>
</ul>
<h3 id="20-批量删除"><a href="#20-批量删除" class="headerlink" title="20. 批量删除"></a>20. 批量删除</h3><h4 id="需求分析-9"><a href="#需求分析-9" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端数据</li>
<li>根据ids删除菜品表，使用lamda表达式写出需要删除的口味表的id，删除两张表需要增加事务</li>
<li>封装对象R返回前端<br> 注：批量删除和删除传输的请求是同一个，不需要重复写一个单独删除功能</li>
</ol>
<h4 id="业务逻辑代码-18"><a href="#业务逻辑代码-18" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量删除</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteByIds</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">deleteCount</span> <span class="operator">=</span> dishMapper.deleteByIds(ids);</span><br><span class="line">    log.info(<span class="string">&quot;成功删除&#123;&#125;条数据&quot;</span>, deleteCount);</span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.in(DishFlavor::getDishId,ids);</span><br><span class="line">    dishFlavorService.remove(qw);</span><br><span class="line">    <span class="keyword">return</span> deleteCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="21-套餐管理分页查询"><a href="#21-套餐管理分页查询" class="headerlink" title="21. 套餐管理分页查询"></a>21. 套餐管理分页查询</h3><h4 id="需求分析-10"><a href="#需求分析-10" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输的分页信息和查询信息</li>
<li>根据排序字段、更新时间字段排序并增加按照菜品名称条件查询</li>
<li>因前端分类名称来源于分类数据表（Category），需建立Dto存储分类名称字段传输前端</li>
<li>把Page&lt;Dish&gt;的属性值拷贝到Page&lt;DishDto&gt;,并排除records</li>
<li>将dish的值存入dishDto并根据categoryId查询name分类名称</li>
<li>设置dishDtoPage的records属性（传输的实际数据属性）</li>
<li>封装对象R返回给前端<br> 注:其他这儿和菜品管理一致的分页需求</li>
</ol>
<h4 id="业务逻辑代码-19"><a href="#业务逻辑代码-19" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p> service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;SetmealDto&gt; <span class="title function_">selectPage</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">    <span class="comment">//创建Page接收page数据</span></span><br><span class="line">    Page&lt;Setmeal&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    Page&lt;SetmealDto&gt; pageinfoDto = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, page);</span><br><span class="line">    <span class="comment">//条件语句建立，根据时间排序，模糊查询名称</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">    qw.like(StringUtils.isNotEmpty(name), Setmeal::getName, name);</span><br><span class="line">    <span class="comment">//调用分页查询</span></span><br><span class="line">    setmealMapper.selectPage(pageInfo, qw);</span><br><span class="line">    <span class="comment">//拷贝对象到pageinfoDto,排除records</span></span><br><span class="line">    BeanUtils.copyProperties(pageInfo, pageinfoDto, <span class="string">&quot;records&quot;</span>);</span><br><span class="line">    <span class="comment">//增加分类名称到pageinfoDto</span></span><br><span class="line">    List&lt;Setmeal&gt; setmeals = pageInfo.getRecords();</span><br><span class="line">    List&lt;SetmealDto&gt; setmealDtos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Setmeal setmeal : setmeals) &#123;</span><br><span class="line">        <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(setmeal, setmealDto);</span><br><span class="line">        <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> categoryService.getById(setmeal.getCategoryId()).getName();</span><br><span class="line">        setmealDto.setCategoryName(categoryName);</span><br><span class="line">        setmealDtos.add(setmealDto);</span><br><span class="line">    &#125;</span><br><span class="line">    pageinfoDto.setRecords(setmealDtos);</span><br><span class="line">    <span class="keyword">return</span> pageinfoDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-套餐管理保存数据"><a href="#22-套餐管理保存数据" class="headerlink" title="22. 套餐管理保存数据"></a>22. 套餐管理保存数据</h3><h4 id="需求分析-11"><a href="#需求分析-11" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输数据，因数据中有套餐菜品关联表接收请求体数据封装为SetmealDto</li>
<li>保存套餐（Setmeal）数据</li>
<li>通过setmealDto中的套餐id给套餐菜品关系表中的套餐id赋值</li>
<li>调用dishFlavorService存储前端传输的dishFlavors集合</li>
<li>因同时操作两张表，需要给次方法加上事务保证数据同事插入</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-20"><a href="#业务逻辑代码-20" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 通过id查询套餐和套餐菜品关系表</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> setmealDto</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> true 修改成功 false 修改失败</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateWithSetmealDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line">     <span class="comment">//修改套餐</span></span><br><span class="line">     <span class="built_in">this</span>.updateById(setmealDto);</span><br><span class="line">     <span class="comment">//修改套餐菜品关系表</span></span><br><span class="line">     <span class="comment">//删除与套餐关联的套餐菜品关系表</span></span><br><span class="line">     LambdaQueryWrapper&lt;SetmealDish&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">     qw.eq(SetmealDish::getSetmealId,setmealDto.getId());</span><br><span class="line">     setmealDishService.remove(qw);</span><br><span class="line">     <span class="comment">//根据前端传输的setmealDto重新插入套餐菜品关系表</span></span><br><span class="line">     List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">     <span class="comment">//setmealDto中的套餐id给套餐菜品关系表中的套餐id赋值</span></span><br><span class="line">     <span class="keyword">for</span> (SetmealDish setmealDish : setmealDishes) &#123;</span><br><span class="line">         setmealDish.setSetmealId(setmealDto.getId());</span><br><span class="line">     &#125;</span><br><span class="line">     setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-套餐管理修改数据"><a href="#23-套餐管理修改数据" class="headerlink" title="23. 套餐管理修改数据"></a>23. 套餐管理修改数据</h3><h4 id="需求分析-12"><a href="#需求分析-12" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>根据前端传输的id查询数据返回给前端</li>
<li>修改套餐表中的数据</li>
<li>删除套餐菜品关系表</li>
<li>保存用户修改的套餐菜品关系表</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-21"><a href="#业务逻辑代码-21" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过id查询套餐和套餐菜品关系表</span><br><span class="line"> * @param setmealDto</span><br><span class="line"> * @return true 修改成功 false 修改失败</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public boolean updateWithSetmealDish(SetmealDto setmealDto) &#123;</span><br><span class="line">    //修改套餐</span><br><span class="line">    this.updateById(setmealDto);</span><br><span class="line">    //修改套餐菜品关系表</span><br><span class="line">    //删除与套餐关联的套餐菜品关系表</span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; qw = new LambdaQueryWrapper();</span><br><span class="line">    qw.eq(SetmealDish::getSetmealId,setmealDto.getId());</span><br><span class="line">    setmealDishService.remove(qw);</span><br><span class="line">    //根据前端传输的setmealDto重新插入套餐菜品关系表</span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">    //setmealDto中的套餐id给套餐菜品关系表中的套餐id赋值</span><br><span class="line">    for (SetmealDish setmealDish : setmealDishes) &#123;</span><br><span class="line">        setmealDish.setSetmealId(setmealDto.getId());</span><br><span class="line">    &#125;</span><br><span class="line">    setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-套餐管理批量停售，启售"><a href="#24-套餐管理批量停售，启售" class="headerlink" title="24. 套餐管理批量停售，启售"></a>24. 套餐管理批量停售，启售</h3><h4 id="需求分析-13"><a href="#需求分析-13" class="headerlink" title="需求分析"></a>需求分析</h4><p>1、接收前端数据<br>2、根据前端传输的状态和id修改状态<br>3、封装数据R返回给前端</p>
<h4 id="业务逻辑代码-22"><a href="#业务逻辑代码-22" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量修改状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateStatus</span><span class="params">(<span class="type">int</span> status, List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;Setmeal&gt; uw = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    uw.in(Setmeal::getId,ids).set(Setmeal::getStatus,status);</span><br><span class="line">    <span class="built_in">this</span>.update(uw);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录-5"><a href="#解决问题记录-5" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><ul>
<li>前端传输过来的数据一直反复调用Controller，找了半天结果发现是把etmealService.updateStatus(status,ids);写成了updateStatus(status,ids);，没调service中的方法，一直在调controller里面的方法所以一直反复循环。</li>
</ul>
<h3 id="25-套餐管理批量删除"><a href="#25-套餐管理批量删除" class="headerlink" title="25. 套餐管理批量删除"></a>25. 套餐管理批量删除</h3><h4 id="需求分析-14"><a href="#需求分析-14" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据</li>
<li>根据前端传输的id集合删除id</li>
<li>封装对象R返回前端</li>
</ol>
<h4 id="业务逻辑代码-23"><a href="#业务逻辑代码-23" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteWithSetmealDishById</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    <span class="comment">//删除套餐表</span></span><br><span class="line">    <span class="built_in">this</span>.removeByIds(ids);</span><br><span class="line">    <span class="comment">//删除套餐菜品关系表</span></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.in(SetmealDish::getSetmealId,ids);</span><br><span class="line">    setmealDishService.remove(qw);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="26-手机端短信验证码登录"><a href="#26-手机端短信验证码登录" class="headerlink" title="26. 手机端短信验证码登录"></a>26. 手机端短信验证码登录</h3><h4 id="需求分析-15"><a href="#需求分析-15" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端传输的手机号&#x2F;邮箱信息</li>
<li>生成随机6位验证码</li>
<li>校验前端传输的数据是邮箱还是手机号</li>
<li>实现第三方SMSapi（腾讯云、qq邮箱）</li>
<li>调用第三方SMSapi成功后保存Session电话号码&#x2F;邮箱作为键，验证码作为值</li>
<li>用户发送验证码成功后接收前端传输用户输入的手机号和验证码</li>
<li>获取Session中的手机号&#x2F;邮箱并与前端传输的数据做对比，如果有数据表示用户登录成功</li>
<li>根据手机号&#x2F;邮箱查询数据库是否存在用户</li>
<li>用户不存在自动注册一个用户</li>
<li>将用户id加入session中，表示用户已登录</li>
</ol>
<h4 id="业务逻辑代码-24"><a href="#业务逻辑代码-24" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><ul>
<li>腾讯云短信Api工具类（本次项目使用，因有腾讯云的云服务器注册比较方便）<br>注：用户名密码需要自己的用户名和密码，注意安全性，不可暴露在互联网上否则会造成严重的财产损失！！！<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.Credential;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.exception.TencentCloudSDKException;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.profile.ClientProfile;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.profile.HttpProfile;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.SmsClient;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendSmsRequest;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendSmsResponse;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendStatus;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSTencentCloudUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送短信</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> signName 签名 签名信息可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-sign)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templateCode 模板 模板 ID 可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-template)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phoneNumbers 手机号 示例如：+8613711112222， 其中前面有一个+号 ，86为国家码，13711112222为手机号，最多不要超过200个手机号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templateParamSet  参数 模板参数: 模板参数的个数需要与 TemplateId 对应模板的变量个数保持一致，若无模板参数，则设置为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SendStatus[] sendMessage(String signName, String templateCode,String[] phoneNumbers,String[] templateParamSet ) <span class="keyword">throws</span> TencentCloudSDKException &#123;</span><br><span class="line">        <span class="comment">/* 必要步骤：</span></span><br><span class="line"><span class="comment">         * 实例化一个认证对象，入参需要传入腾讯云账户密钥对secretId，secretKey。</span></span><br><span class="line"><span class="comment">         * 这里采用的是从环境变量读取的方式，需要在环境变量中先设置这两个值。</span></span><br><span class="line"><span class="comment">         * 你也可以直接在代码中写死密钥对，但是小心不要将代码复制、上传或者分享给他人，</span></span><br><span class="line"><span class="comment">         * 以免泄露密钥对危及你的财产安全。</span></span><br><span class="line"><span class="comment">         * SecretId、SecretKey 查询: https://console.cloud.tencent.com/cam/capi */</span></span><br><span class="line">        <span class="type">Credential</span> <span class="variable">cred</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Credential</span>(<span class="string">&quot;用户名&quot;</span>, <span class="string">&quot;密码&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化一个http选项，可选，没有特殊需求可以跳过</span></span><br><span class="line">        <span class="type">HttpProfile</span> <span class="variable">httpProfile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpProfile</span>();</span><br><span class="line">        <span class="comment">// 设置代理（无需要直接忽略）</span></span><br><span class="line">        <span class="comment">// httpProfile.setProxyHost(&quot;真实代理ip&quot;);</span></span><br><span class="line">        <span class="comment">// httpProfile.setProxyPort(真实代理端口);</span></span><br><span class="line">        <span class="comment">/* SDK默认使用POST方法。</span></span><br><span class="line"><span class="comment">         * 如果你一定要使用GET方法，可以在这里设置。GET方法无法处理一些较大的请求 */</span></span><br><span class="line">        httpProfile.setReqMethod(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        <span class="comment">/* SDK有默认的超时时间，非必要请不要进行调整</span></span><br><span class="line"><span class="comment">         * 如有需要请在代码中查阅以获取最新的默认值 */</span></span><br><span class="line">        httpProfile.setConnTimeout(<span class="number">60</span>);</span><br><span class="line">        <span class="comment">/* 指定接入地域域名，默认就近地域接入域名为 sms.tencentcloudapi.com ，也支持指定地域域名访问，例如广州地域的域名为 sms.ap-guangzhou.tencentcloudapi.com */</span></span><br><span class="line">        httpProfile.setEndpoint(<span class="string">&quot;sms.tencentcloudapi.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 非必要步骤:</span></span><br><span class="line"><span class="comment">         * 实例化一个客户端配置对象，可以指定超时时间等配置 */</span></span><br><span class="line">        <span class="type">ClientProfile</span> <span class="variable">clientProfile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientProfile</span>();</span><br><span class="line">        <span class="comment">/* SDK默认用TC3-HMAC-SHA256进行签名</span></span><br><span class="line"><span class="comment">         * 非必要请不要修改这个字段 */</span></span><br><span class="line"><span class="comment">//        clientProfile.setSignMethod(&quot;HmacSHA256&quot;);</span></span><br><span class="line">        clientProfile.setHttpProfile(httpProfile);</span><br><span class="line">        <span class="comment">/* 实例化要请求产品(以sms为例)的client对象</span></span><br><span class="line"><span class="comment">         * 第二个参数是地域信息，可以直接填写字符串ap-guangzhou，支持的地域列表参考 https://cloud.tencent.com/document/api/382/52071#.E5.9C.B0.E5.9F.9F.E5.88.97.E8.A1.A8 */</span></span><br><span class="line">        <span class="type">SmsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsClient</span>(cred, <span class="string">&quot;ap-guangzhou&quot;</span>,clientProfile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 实例化一个请求对象，根据调用的接口和实际情况，可以进一步设置请求参数</span></span><br><span class="line"><span class="comment">         * 你可以直接查询SDK源码确定接口有哪些属性可以设置</span></span><br><span class="line"><span class="comment">         * 属性可能是基本类型，也可能引用了另一个数据结构</span></span><br><span class="line"><span class="comment">         * 推荐使用IDE进行开发，可以方便的跳转查阅各个接口和数据结构的文档说明 */</span></span><br><span class="line">        <span class="type">SendSmsRequest</span> <span class="variable">req</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 短信应用ID: 短信SdkAppId在 [短信控制台] 添加应用后生成的实际SdkAppId，示例如1400006666 */</span></span><br><span class="line">        <span class="comment">// 应用 ID 可前往 [短信控制台](https://console.cloud.tencent.com/smsv2/app-manage) 查看</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sdkAppId</span> <span class="operator">=</span> <span class="string">&quot;短信应用ID&quot;</span>;</span><br><span class="line">        req.setSmsSdkAppId(sdkAppId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 短信签名内容: 使用 UTF-8 编码，必须填写已审核通过的签名 */</span></span><br><span class="line">        <span class="comment">// 签名信息可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-sign) 或 [国际/港澳台短信](https://console.cloud.tencent.com/smsv2/isms-sign) 的签名管理查看</span></span><br><span class="line">        req.setSignName(signName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 模板 ID: 必须填写已审核通过的模板 ID */</span></span><br><span class="line">        <span class="comment">// 模板 ID 可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-template) 或 [国际/港澳台短信](https://console.cloud.tencent.com/smsv2/isms-template) 的正文模板管理查看</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateId</span> <span class="operator">=</span> <span class="string">&quot;模板ID&quot;</span>;</span><br><span class="line">        req.setTemplateId(templateId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 模板参数: 模板参数的个数需要与 TemplateId 对应模板的变量个数保持一致，若无模板参数，则设置为空 */</span></span><br><span class="line">        String[] temp = templateParamSet;</span><br><span class="line">        req.setTemplateParamSet(temp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 下发手机号码，采用 E.164 标准，+[国家或地区码][手机号]</span></span><br><span class="line"><span class="comment">         * 示例如：+8613711112222， 其中前面有一个+号 ，86为国家码，13711112222为手机号，最多不要超过200个手机号 */</span></span><br><span class="line">        <span class="keyword">for</span> (String phoneNumber : phoneNumbers) &#123;</span><br><span class="line">            phoneNumber = <span class="string">&quot;+86&quot;</span>+phoneNumber;</span><br><span class="line">        &#125;</span><br><span class="line">        req.setPhoneNumberSet(phoneNumbers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 通过 client 对象调用 SendSms 方法发起请求。注意请求方法名与请求对象是对应的</span></span><br><span class="line"><span class="comment">         * 返回的 res 是一个 SendSmsResponse 类的实例，与请求对象对应 */</span></span><br><span class="line">        <span class="type">SendSmsResponse</span> <span class="variable">res</span> <span class="operator">=</span> client.SendSms(req);</span><br><span class="line">        SendStatus[] sendStatusSet = res.getSendStatusSet();</span><br><span class="line">        log.info(<span class="string">&quot;腾讯云短信服务返回结果：&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;PhoneNumber: &quot;</span> + sendStatusSet[<span class="number">0</span>].getPhoneNumber());</span><br><span class="line">        log.info(<span class="string">&quot;Fee: &quot;</span> + sendStatusSet[<span class="number">0</span>].getFee());</span><br><span class="line">        log.info(<span class="string">&quot;Code: &quot;</span> + sendStatusSet[<span class="number">0</span>].getCode());</span><br><span class="line">        log.info(<span class="string">&quot;Message: &quot;</span> + sendStatusSet[<span class="number">0</span>].getMessage());</span><br><span class="line">        <span class="keyword">return</span> sendStatusSet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>阿里巴巴短信接口工具类（本次项目未使用）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import com.aliyuncs.DefaultAcsClient;</span></span><br><span class="line"><span class="comment">//import com.aliyuncs.IAcsClient;</span></span><br><span class="line"><span class="comment">//import com.aliyuncs.dysmsapi.model.v20170525.SendSmsRequest;</span></span><br><span class="line"><span class="comment">//import com.aliyuncs.dysmsapi.model.v20170525.SendSmsResponse;</span></span><br><span class="line"><span class="comment">//import com.aliyuncs.exceptions.ClientException;</span></span><br><span class="line"><span class="comment">//import com.aliyuncs.profile.DefaultProfile;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信发送工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSAlibabaUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 阿里巴巴发送短信</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> signName 签名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> templateCode 模板</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> phoneNumbers 手机号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param 参数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String signName, String templateCode,String phoneNumbers,String param)</span>&#123;</span><br><span class="line"><span class="comment">//		DefaultProfile profile = DefaultProfile.getProfile(&quot;cn-hangzhou&quot;, &quot;&quot;, &quot;&quot;);</span></span><br><span class="line"><span class="comment">//		IAcsClient client = new DefaultAcsClient(profile);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		SendSmsRequest request = new SendSmsRequest();</span></span><br><span class="line"><span class="comment">//		request.setSysRegionId(&quot;cn-hangzhou&quot;);</span></span><br><span class="line"><span class="comment">//		request.setPhoneNumbers(phoneNumbers);</span></span><br><span class="line"><span class="comment">//		request.setSignName(signName);</span></span><br><span class="line"><span class="comment">//		request.setTemplateCode(templateCode);</span></span><br><span class="line"><span class="comment">//		request.setTemplateParam(&quot;&#123;\&quot;code\&quot;:\&quot;&quot;+param+&quot;\&quot;&#125;&quot;);</span></span><br><span class="line"><span class="comment">//		try &#123;</span></span><br><span class="line"><span class="comment">//			SendSmsResponse response = client.getAcsResponse(request);</span></span><br><span class="line"><span class="comment">//			System.out.println(&quot;短信发送成功&quot;);</span></span><br><span class="line"><span class="comment">//		&#125;catch (ClientException e) &#123;</span></span><br><span class="line"><span class="comment">//			e.printStackTrace();</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>手机号&#x2F;邮箱账号校验工具类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证码，手机号校验工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidatorUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PHONE_NUMBER_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;^(13[0-9]&#123;9&#125;)|(15[0-9]&#123;9&#125;)|(17[0-9]&#123;9&#125;)|(18[0-9]&#123;9&#125;)|(19[0-9]&#123;9&#125;)$&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EMAIL_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]&#123;2,&#125;$&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">validatePhoneNumber</span><span class="params">(String phoneNumber)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(PHONE_NUMBER_PATTERN, phoneNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">validateEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(EMAIL_PATTERN, email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>随机数生成工具类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成验证码工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度为4位或者6位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">generateValidateCode</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(length == <span class="number">4</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">9999</span>);<span class="comment">//生成随机数，最大为9999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">1000</span>;<span class="comment">//保证随机数为4位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(length == <span class="number">6</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">999999</span>);<span class="comment">//生成随机数，最大为999999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">100000</span>;<span class="comment">//保证随机数为6位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;只能生成4位或6位数字验证码&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成指定长度字符串验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateValidateCode4String</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rdm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash1</span> <span class="operator">=</span> Integer.toHexString(rdm.nextInt());</span><br><span class="line">        <span class="type">String</span> <span class="variable">capstr</span> <span class="operator">=</span> hash1.substring(<span class="number">0</span>, length);</span><br><span class="line">        <span class="keyword">return</span> capstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>短信验证码Service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">sendMsg</span><span class="params">(User user, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//生成验证码</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ValidateCode</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">6</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">LoginNum</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line">    log.info(<span class="string">&quot;生成的验证码为:&#123;&#125;&quot;</span>,ValidateCode);</span><br><span class="line">    <span class="comment">//校验前端传输的是电话还是邮箱</span></span><br><span class="line">    <span class="keyword">if</span>(ValidatorUtils.validatePhoneNumber(LoginNum))&#123;</span><br><span class="line">        <span class="comment">//发送手机验证码</span></span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;为手机号，准备发送短信&quot;</span>,LoginNum);</span><br><span class="line">        <span class="comment">//签名名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">siginName</span> <span class="operator">=</span> <span class="string">&quot;签名名称&quot;</span>;</span><br><span class="line">        <span class="comment">//模板id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateCode</span> <span class="operator">=</span> <span class="string">&quot;模板id&quot;</span>;</span><br><span class="line">        <span class="comment">//电话号码 因为登录只有一个电话号只传输一个就好了</span></span><br><span class="line">        String[] phones = &#123;LoginNum&#125;;</span><br><span class="line">        <span class="comment">//模板参数 这儿其实就是验证码 模板里面定义的参数，模板中定义了几个参数这儿就要填对应的个数且顺序不能乱</span></span><br><span class="line">        String[] params = &#123;ValidateCode+<span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        SendStatus[] sendStatuses = SMSTencentCloudUtils.sendMessage(siginName,templateCode, phones, params);</span><br><span class="line">        <span class="comment">//打印腾讯云返回结果，这儿因为只传了一个手机号直接取数组第一个元素就可以了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">SMSCode</span> <span class="operator">=</span>sendStatuses[<span class="number">0</span>].getCode().toString();</span><br><span class="line">        <span class="comment">//判断短信发送是否成功，成功getCode为OK，如果失败则抛出业务异常返回前端</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;Ok&quot;</span>.equals(SMSCode))&#123;</span><br><span class="line">            <span class="comment">//发送成功，设置session存储手机号和对应的验证码</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;ValidateCode&quot;</span>+LoginNum,ValidateCode + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;发送验证码失败，请再试一次&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (TencentCloudSDKException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;短信平台问题，无法发送短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ValidatorUtils.validateEmail(user.getPhone()))&#123;</span><br><span class="line">        <span class="comment">//TODO 发送邮箱</span></span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;为邮箱，准备发送邮件&quot;</span>,user.getPhone());</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果不为手机号或邮箱则格式错误抛出业务异常返回前端</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;请输入手机号或邮箱&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户登录Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">loginByCode</span><span class="params">(Map map, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//获取集合中的手机号和验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">LoginNum</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line">    <span class="type">String</span> <span class="variable">validateCode</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line">    <span class="comment">//获取存储验证码的session</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">validateCodeSession</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;ValidateCode&quot;</span> + LoginNum);</span><br><span class="line">    log.info(<span class="string">&quot;获取到的session数据:&#123;&#125;&quot;</span>,validateCodeSession);</span><br><span class="line">    <span class="keyword">if</span>(validateCodeSession != <span class="literal">null</span> &amp;&amp; validateCodeSession.equals(validateCode))&#123;</span><br><span class="line">        <span class="comment">//登录成功 获取user</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">        qw.eq(User::getPhone,LoginNum);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(qw);</span><br><span class="line">        <span class="comment">//如果查询到的用户为空说明用户是新用户，需要自动注册一个用户</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setPhone(LoginNum);</span><br><span class="line">            user.setStatus(<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">this</span>.save(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;employee&quot;</span>, user.getId());</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;您输入的验证码有误，请检查！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决问题记录-6"><a href="#解决问题记录-6" class="headerlink" title="解决问题记录"></a>解决问题记录</h4><ol>
<li>在以下代码中，先获取user，如果user&#x3D;null的话记得在if判断里面需要再new一次对象，因为此时对象为null</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(qw);</span><br><span class="line"><span class="comment">//如果查询到的用户为空说明用户是新用户，需要自动注册一个用户</span></span><br><span class="line"><span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">    user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setPhone(LoginNum);</span><br><span class="line">    user.setStatus(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">this</span>.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="27-地址管理查询列表"><a href="#27-地址管理查询列表" class="headerlink" title="27. 地址管理查询列表"></a>27. 地址管理查询列表</h3><h4 id="需求分析-16"><a href="#需求分析-16" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端数据</li>
<li>获取Session中的userId</li>
<li>通过userId获取当前地址列表</li>
<li>封装对象R返回前端</li>
</ol>
<h4 id="业务逻辑代码-25"><a href="#业务逻辑代码-25" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">getList</span><span class="params">(HttpServletRequest req)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;地址管理获取列表&quot;</span>);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    List&lt;AddressBook&gt; addressBooks = addressBookService.selectListByUser(userId);</span><br><span class="line">    <span class="keyword">return</span> R.success(addressBooks);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AddressBook&gt; <span class="title function_">selectListByUser</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">    <span class="comment">//查询数据库中的userId，查询当前用户下的地址</span></span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    qw.eq(AddressBook::getUserId,userId);</span><br><span class="line">    List&lt;AddressBook&gt; addressBooks = addressBookMapper.selectList(qw);</span><br><span class="line">    <span class="keyword">return</span> addressBooks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="28-地址管理修改数据"><a href="#28-地址管理修改数据" class="headerlink" title="28. 地址管理修改数据"></a>28. 地址管理修改数据</h3><p>1、获取前端发送的地址Id<br>2、根据地址Id查询数据库<br>3、封装对象R返回地址对象<br>4、获取前端发送的修改数据<br>5、根据id修改数据<br>6、返回数据给前端</p>
<h4 id="业务逻辑代码-26"><a href="#业务逻辑代码-26" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">selectById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;地址管理通过id查询的前端参数为：&#123;&#125;&quot;</span>,id);</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id修改</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;地址管理通过id修改接收到的前端参数为：&#123;&#125;&quot;</span>,addressBook);</span><br><span class="line">    addressBookService.updateById(addressBook);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="29-地址管理修改默认地址"><a href="#29-地址管理修改默认地址" class="headerlink" title="29. 地址管理修改默认地址"></a>29. 地址管理修改默认地址</h3><h4 id="需求分析-17"><a href="#需求分析-17" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端传输数据</li>
<li>获取当前登录用户存储再Session的userId</li>
<li>将登录用户的默认地址改为非默认状态</li>
<li>将登录用户勾选的默认地址改为默认状态</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-27"><a href="#业务逻辑代码-27" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改默认地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">updateDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook,HttpServletRequest req)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;地址管理修改默认地址接收到的前端参数为：&#123;&#125;&quot;</span>,addressBook);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    addressBook.setUserId(userId);</span><br><span class="line">    addressBookService.updateDefault(addressBook);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateDefault</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    <span class="comment">//将本用户下的默认地址全部修改为0</span></span><br><span class="line">    <span class="comment">//创建一个AddressBook对象用于更新</span></span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">updateAddressBookDefaultInit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddressBook</span>();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> addressBook.getUserId();</span><br><span class="line">    updateAddressBookDefaultInit.setIsDefault(<span class="number">0</span>);</span><br><span class="line">    updateAddressBookDefaultInit.setUserId(userId);</span><br><span class="line">    LambdaUpdateWrapper&lt;AddressBook&gt; uw = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    uw.eq(AddressBook::getUserId,addressBook.getUserId());</span><br><span class="line">    uw.eq(AddressBook::getIsDefault,<span class="number">1</span>);</span><br><span class="line">    addressBookMapper.update(updateAddressBookDefaultInit,uw);</span><br><span class="line">    <span class="comment">//设置前端传输的地址为默认地址</span></span><br><span class="line">    addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//因为拿到前端的地址id可以，清空userId提升update效率</span></span><br><span class="line">    addressBook.setUserId(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//更新前端传输的默认地址</span></span><br><span class="line">    addressBookMapper.updateById(addressBook);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="30-地址管理删除"><a href="#30-地址管理删除" class="headerlink" title="30. 地址管理删除"></a>30. 地址管理删除</h3><h4 id="需求分析-18"><a href="#需求分析-18" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端传输的id</li>
<li>根据id删除地址</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务需求代码"><a href="#业务需求代码" class="headerlink" title="业务需求代码"></a>业务需求代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping()</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">deleteById</span><span class="params">(<span class="meta">@RequestParam</span> Long ids)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除地址接收到的前端参数为：&#123;&#125;&quot;</span>,ids);</span><br><span class="line">    addressBookService.removeById(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="31-手机端主页显示"><a href="#31-手机端主页显示" class="headerlink" title="31.手机端主页显示"></a>31.手机端主页显示</h3><h4 id="需求分析-19"><a href="#需求分析-19" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取分类管理（前面已做过，前端直接调用方法就可以了）</li>
<li>改造菜品（增加口味数据），套餐列表获取</li>
</ol>
<h4 id="业务逻辑代码-28"><a href="#业务逻辑代码-28" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>菜品管理service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;DishDto&gt; <span class="title function_">list</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> dishDto.getCategoryId();</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotEmpty(categoryId.toString()))&#123;</span><br><span class="line">        qw.eq(Dish::getCategoryId,categoryId);</span><br><span class="line">        qw.eq(Dish::getStatus,dishDto.getStatus());</span><br><span class="line">        qw.orderByDesc(Dish::getUpdateTime);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Dish&gt; dishes = <span class="built_in">this</span>.list(qw);</span><br><span class="line">    List&lt;DishDto&gt; dishDtos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Dish dish : dishes) &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDtoTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(dish,dishDtoTemp);</span><br><span class="line">        <span class="comment">//查询菜品口味关联表集合</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; dishFlavorQW = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//查询菜品表的id</span></span><br><span class="line">        dishFlavorQW.eq(DishFlavor::getDishId,dish.getId());</span><br><span class="line">        <span class="comment">//查询根据菜品表ID查询菜品口味关联表表集合</span></span><br><span class="line">        List&lt;DishFlavor&gt; dishFlavorList = dishFlavorService.list(dishFlavorQW);</span><br><span class="line">        dishDtoTemp.setFlavors(dishFlavorList);</span><br><span class="line">        <span class="comment">//将拷贝的对象加入dishDtos集合</span></span><br><span class="line">        dishDtos.add(dishDtoTemp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dishDtos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Setmeal&gt; <span class="title function_">selectList</span><span class="params">(Setmeal setmeal)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    qw.eq(setmeal.getCategoryId()!=<span class="literal">null</span>,Setmeal::getCategoryId,setmeal.getCategoryId());</span><br><span class="line">    qw.eq(setmeal.getStatus()!=<span class="literal">null</span>,Setmeal::getStatus,setmeal.getStatus());</span><br><span class="line">    List&lt;Setmeal&gt; setmeals = setmealMapper.selectList(qw);</span><br><span class="line">    <span class="keyword">return</span> setmeals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="32-查询购物车列表"><a href="#32-查询购物车列表" class="headerlink" title="32. 查询购物车列表"></a>32. 查询购物车列表</h3><h4 id="需求分析-20"><a href="#需求分析-20" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端数据，并获取session中的user添加到对象中</li>
<li>根据当前登录user查询</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-29"><a href="#业务逻辑代码-29" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ShoppingCart&gt; <span class="title function_">selectList</span><span class="params">(ShoppingCart shoppingCart)</span> &#123;</span><br><span class="line">    <span class="comment">//通过userId查询列表返回给前端</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    qw.eq(ShoppingCart::getUserId,shoppingCart.getUserId());</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.list(qw);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="33-添加购物车"><a href="#33-添加购物车" class="headerlink" title="33. 添加购物车"></a>33. 添加购物车</h3><h4 id="需求分析-21"><a href="#需求分析-21" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端数据，并获取session中的user添加到查询对象中</li>
<li>判断接收到的数据是菜品或者套餐</li>
<li>判断套餐或菜品是否已存在，存在在原有基础上+1，不存在添加到购物车，数量默认为1</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-30"><a href="#业务逻辑代码-30" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ShoppingCart <span class="title function_">addShoppingCar</span><span class="params">(ShoppingCart shoppingCart)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line">    <span class="comment">//判断当前是套餐或者菜品，并查询数据</span></span><br><span class="line">    <span class="type">ShoppingCart</span> <span class="variable">shoppingCartTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(dishId != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//当前为菜品</span></span><br><span class="line">        log.info(<span class="string">&quot;当前数据为菜品dishId:&#123;&#125;&quot;</span>,dishId);</span><br><span class="line">        qw.eq(ShoppingCart::getDishId,shoppingCart.getDishId());</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//当前为套餐</span></span><br><span class="line">        log.info(<span class="string">&quot;当前数据为套餐dishId:&#123;&#125;&quot;</span>,dishId);</span><br><span class="line">        qw.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());</span><br><span class="line">    &#125;</span><br><span class="line">    qw.eq(ShoppingCart::getUserId,shoppingCart.getUserId());</span><br><span class="line">    shoppingCartTemp = <span class="built_in">this</span>.getOne(qw);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断套餐或菜品是否已存在</span></span><br><span class="line">    <span class="keyword">if</span>(shoppingCartTemp != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//如果已存在，再原来的基础上+1</span></span><br><span class="line">        log.info(<span class="string">&quot;当前数据已存在 shoppingCartTemp:&#123;&#125;&quot;</span>,shoppingCartTemp);</span><br><span class="line">        LambdaUpdateWrapper&lt;ShoppingCart&gt; uw = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>();</span><br><span class="line">        shoppingCartTemp.setNumber(shoppingCartTemp.getNumber()+<span class="number">1</span>);</span><br><span class="line">        uw.set(ShoppingCart::getNumber,shoppingCartTemp.getNumber());</span><br><span class="line">        uw.eq(ShoppingCart::getId,shoppingCartTemp.getId());</span><br><span class="line">        <span class="built_in">this</span>.update(uw);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果不存在，则添加到购物车，数量默认为1</span></span><br><span class="line">        log.info(<span class="string">&quot;当前数据不存在 shoppingCartTemp:&#123;&#125;&quot;</span>,shoppingCartTemp);</span><br><span class="line">        shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">this</span>.save(shoppingCart);</span><br><span class="line">        shoppingCartTemp = shoppingCart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> shoppingCartTemp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="34-减少购物车"><a href="#34-减少购物车" class="headerlink" title="34. 减少购物车"></a>34. 减少购物车</h3><h4 id="需求分析-22"><a href="#需求分析-22" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据，并获取session中的user添加到对象中</li>
<li>判断当前是套餐或菜品，并查询数据</li>
<li>判断套餐或菜品是否小于1，大于1在原基础上数量-1，小于或者等于1删除数据</li>
<li>封装对象R返回前端</li>
</ol>
<h4 id="业务逻辑代码-31"><a href="#业务逻辑代码-31" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public ShoppingCart subShoppingCar(ShoppingCart shoppingCart) &#123;</span><br><span class="line">    Long dishId = shoppingCart.getDishId();</span><br><span class="line">    //判断当前是套餐或者菜品，并查询数据</span><br><span class="line">    ShoppingCart shoppingCartTemp = new ShoppingCart();</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; qw = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    if(dishId != null)&#123;</span><br><span class="line">        //当前为菜品</span><br><span class="line">        log.info(&quot;当前数据为菜品dishId:&#123;&#125;&quot;,dishId);</span><br><span class="line">        qw.eq(ShoppingCart::getDishId,shoppingCart.getDishId());</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        //当前为套餐</span><br><span class="line">        log.info(&quot;当前数据为套餐dishId:&#123;&#125;&quot;,dishId);</span><br><span class="line">        qw.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());</span><br><span class="line">    &#125;</span><br><span class="line">    qw.eq(ShoppingCart::getUserId,shoppingCart.getUserId());</span><br><span class="line">    shoppingCartTemp = this.getOne(qw);</span><br><span class="line"></span><br><span class="line">    //判断套餐或菜品是否小于1</span><br><span class="line">    if(shoppingCartTemp.getNumber() &gt; 1)&#123;</span><br><span class="line">        //大于1，再原来的基础上-1</span><br><span class="line">        log.info(&quot;大于1 shoppingCartTemp:&#123;&#125;&quot;,shoppingCartTemp);</span><br><span class="line">        LambdaUpdateWrapper&lt;ShoppingCart&gt; uw = new LambdaUpdateWrapper();</span><br><span class="line">        shoppingCartTemp.setNumber(shoppingCartTemp.getNumber()-1);</span><br><span class="line">        uw.set(ShoppingCart::getNumber,shoppingCartTemp.getNumber());</span><br><span class="line">        uw.eq(ShoppingCart::getId,shoppingCartTemp.getId());</span><br><span class="line">        this.update(uw);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        //不大于1，删除数据</span><br><span class="line">        log.info(&quot;不大于1 shoppingCartTemp:&#123;&#125;&quot;,shoppingCartTemp);</span><br><span class="line">        shoppingCartTemp.setNumber(0);</span><br><span class="line">        this.removeById(shoppingCartTemp.getId());</span><br><span class="line">    &#125;</span><br><span class="line">    return shoppingCartTemp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="35-清空购物车"><a href="#35-清空购物车" class="headerlink" title="35. 清空购物车"></a>35. 清空购物车</h3><h4 id="需求分析-23"><a href="#需求分析-23" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据，并获取session中的user添加到对象中</li>
<li>根据当前登录用户删除购物车</li>
<li>封装对象R返回前端</li>
</ol>
<h3 id="36-获取默认订单地址"><a href="#36-获取默认订单地址" class="headerlink" title="36. 获取默认订单地址"></a>36. 获取默认订单地址</h3><h4 id="需求分析-24"><a href="#需求分析-24" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据，并获取session中的user添加到对象中</li>
<li>根据当前登录用户和默认地址获取地址</li>
<li>封装对象R返回前端</li>
</ol>
<h4 id="业务逻辑代码-32"><a href="#业务逻辑代码-32" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AddressBook <span class="title function_">getDefault</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> addressBook.getUserId();</span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    qw.eq(AddressBook::getUserId,userId);</span><br><span class="line">    qw.eq(AddressBook::getIsDefault,<span class="number">1</span>);</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBookReturn</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(qw);</span><br><span class="line">    <span class="keyword">return</span> addressBookReturn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="37-修改订单地址"><a href="#37-修改订单地址" class="headerlink" title="37. 修改订单地址"></a>37. 修改订单地址</h3><h4 id="需求分析-25"><a href="#需求分析-25" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>地址簿页面修改前端代码将用户选择的地址发送请求到后端，下订单页面获取后端用户选择的地址</li>
<li>将地址簿前端返回上一页改为跳转到下订单页面</li>
<li>接收前端请求并存储到session中</li>
<li>获取session中存储的地址再发送到前端<br>注：这个地方个人觉得黑马的设计不太合理，选择地址簿之后就修改默认地址，虽然数据库改了，但是返回到订单页面还是之前的地址，因此在这儿重写了前端</li>
</ol>
<h4 id="业务逻辑代码-33"><a href="#业务逻辑代码-33" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p><em><strong>address.js添加两个方法</strong></em></p>
<ol>
<li><p>用于设置当前登录用户选择地址</p>
</li>
<li><p>用于查询当前登录用户选择地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//查询当前登录选择地址</span><br><span class="line">function getNowAddressApi() &#123;</span><br><span class="line">    return $axios(&#123;</span><br><span class="line">        &#x27;url&#x27;: &#x27;/addressBook/getNowAddress&#x27;,</span><br><span class="line">        &#x27;method&#x27;: &#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">//设置当前登录选择地址</span><br><span class="line">function setNowAddressApi(id) &#123;</span><br><span class="line">    return $axios(&#123;</span><br><span class="line">        url: `/addressBook/setNowAddress?id=$&#123;id&#125;`,</span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em><strong>address.html</strong></em></p>
</li>
<li><p>添加setNowAddress方法，用于发送和接收设置地址请求</p>
</li>
<li><p>重写itemClick方法，在跳转前调用setNowAddress方法，改为跳转’&#x2F;front&#x2F;page&#x2F;add-order.html’<br>注：这个地方改为跳转是因为返回上一页不能调用create钩子函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">async setNowAddress(id)&#123;</span><br><span class="line">    if(id)&#123;</span><br><span class="line">        const res = await setNowAddressApi(id)</span><br><span class="line">        alert(&quot;获取到的后端数据为：&quot;+res.data.id)</span><br><span class="line">        if(res.code == 1)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            this.$message.error(res.msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">itemClick(item)&#123;</span><br><span class="line">    const url = document.referrer</span><br><span class="line">    //表示是从订单页面跳转过来的</span><br><span class="line">    if(url.includes(&#x27;order&#x27;))&#123;</span><br><span class="line">        // 修改默认地址</span><br><span class="line">        // this.setDefaultAddress(item)</span><br><span class="line">        // addressFindOneApi(item.id);</span><br><span class="line">        this.setNowAddress(item.id)</span><br><span class="line">        window.location.href = &#x27;/front/page/add-order.html&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>add-order.html</p>
</li>
<li><p>添加getNowAddress方法，用于发送和接收获取地址请求</p>
</li>
<li><p>重写created中的initData方法，校验是否是从address.html地址簿跳转过来的，如果是则调用getNowAddress方法，如果不是则调用默认地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前选择地址</span></span><br><span class="line">async <span class="title function_">getNowAddress</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">res</span> <span class="operator">=</span> await <span class="title function_">getNowAddressApi</span><span class="params">()</span></span><br><span class="line">    <span class="keyword">if</span> (res.code == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = res.data</span><br><span class="line">        <span class="built_in">this</span>.getFinishTime()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        window.requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">            window.location.href = <span class="string">&#x27;/front/page/address-edit.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Controller</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取默认地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getDefalut</span><span class="params">(AddressBook addressBook , HttpSession session)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;获取默认地址接收到的前端参数为：&#123;&#125;&quot;</span>,addressBook);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    addressBook.setUserId(userId);</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBookDefault</span> <span class="operator">=</span> addressBookService.getDefault(addressBook);</span><br><span class="line">    <span class="keyword">if</span>(addressBookDefault == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前地址为空，请添加地址信息！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;nowAddress&quot;</span>+userId,addressBookDefault.getId());</span><br><span class="line">    session.setMaxInactiveInterval(<span class="number">365</span> *<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">100</span>); <span class="comment">//30分*60秒</span></span><br><span class="line">    <span class="keyword">return</span> R.success(addressBookDefault);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置用户现在选择的地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/setNowAddress&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">setNowAddress</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id, HttpServletRequest req)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;地址管理设置当前选择地址的前端参数为：id:&#123;&#125;&quot;</span>, id);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">    session.setAttribute(<span class="string">&quot;nowAddress&quot;</span>+userId,id);</span><br><span class="line">    session.setMaxInactiveInterval(<span class="number">365</span> *<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">100</span>); <span class="comment">//30分*60秒</span></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;设置用户当前地址成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户现在选择的地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getNowAddress&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getNowAddress</span><span class="params">(HttpServletRequest req)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;地址管理获取当前选择地址&quot;</span>);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">dddressId</span> <span class="operator">=</span> (Long) session.getAttribute(<span class="string">&quot;nowAddress&quot;</span> + userId);</span><br><span class="line">    log.info(<span class="string">&quot;开始通过地址id查询当前选择地址dddressId：&#123;&#125;&quot;</span>,dddressId);</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(dddressId);</span><br><span class="line">    <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="38-手机端主页点击套餐图片显示套餐详情"><a href="#38-手机端主页点击套餐图片显示套餐详情" class="headerlink" title="38. 手机端主页点击套餐图片显示套餐详情"></a>38. 手机端主页点击套餐图片显示套餐详情</h3><h4 id="需求分析-26"><a href="#需求分析-26" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据</li>
<li>查询套餐菜品匹配表数据</li>
<li>将数据拷贝到菜品Dto中，这个地方需要拷贝两个，一个是套餐菜品匹配表（份数），一个是菜品表（菜品详情信息）</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-34"><a href="#业务逻辑代码-34" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;DishDto&gt; <span class="title function_">selectDishBySetmeal</span><span class="params">(Long setmealId)</span> &#123;</span><br><span class="line">    <span class="comment">//查询套餐菜品匹配表数据</span></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    qw.eq(SetmealDish::getSetmealId,setmealId);</span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishList = setmealDishService.list(qw);</span><br><span class="line"></span><br><span class="line">    List&lt;DishDto&gt; dishDtoList = setmealDishList.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        <span class="comment">//拷贝套餐菜品匹配表到dishDto，主要是为了前端显示份数字段</span></span><br><span class="line">        BeanUtils.copyProperties(item,dishDto);</span><br><span class="line">        <span class="comment">//查询菜品id</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishService.getById(item.getDishId());</span><br><span class="line">        <span class="comment">//拷贝对象到dishDto</span></span><br><span class="line">        BeanUtils.copyProperties(dish,dishDto);</span><br><span class="line">        <span class="keyword">return</span> dishDto;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> dishDtoList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="39-用户下单"><a href="#39-用户下单" class="headerlink" title="39. 用户下单"></a>39. 用户下单</h3><h4 id="需求分析-27"><a href="#需求分析-27" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据，并获取session中的user和当前选择地址添加到对象中</li>
<li>修改“获取默认地址”接口，增加把默认地址放入Session中（这个地方主要是获取地址要统一）并获取地址簿信息</li>
<li>根据当前登录用户获取购物车信息</li>
<li>获取用户信息，这一步主要是用于完善订单表数据库字段</li>
<li>生成订单号，注这个地方要先生成订单id，因为有明细表需要一起插入</li>
<li>插入数据到订单明细表中，并在插入时算出订单总额</li>
<li>插入数据到订单表</li>
<li>校验是否成功，如果成功清空购物车数据</li>
<li>封装对象R返回前端<br>注：这个地方需要加事务，因涉及两张表同时插入</li>
</ol>
<h4 id="业务逻辑代码-35"><a href="#业务逻辑代码-35" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">submit</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">    <span class="comment">//获取地址簿信息</span></span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; addressBookLambdaQW = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    addressBookLambdaQW.eq(AddressBook::getId,orders.getAddressBookId());</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getOne(addressBookLambdaQW);</span><br><span class="line">    <span class="keyword">if</span>(addressBook == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前地址错误，请添加后再试&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取购物车信息</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; shoppingCartQW = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">    <span class="comment">//根据当前登录用户获取购物车信息</span></span><br><span class="line">    shoppingCartQW.eq(ShoppingCart::getUserId,orders.getUserId());</span><br><span class="line">    List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartService.list(shoppingCartQW);</span><br><span class="line">    <span class="keyword">if</span>(shoppingCartList == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前购物车信息有误，请检查后再试&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取用户信息，用于完善数据库字段</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(orders.getUserId());</span><br><span class="line">    <span class="comment">//生成订单号</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">orderNum</span> <span class="operator">=</span> IdWorker.getId() ;</span><br><span class="line">    <span class="comment">//订单合计金额 DoubleAdder类提供线程安全</span></span><br><span class="line">    <span class="type">DoubleAdder</span> <span class="variable">amountSum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleAdder</span>();</span><br><span class="line">    <span class="comment">//插入数据到订单明细表</span></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList = shoppingCartList.stream().map((shoppingCartItem) -&gt; &#123;</span><br><span class="line">        <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">        orderDetail.setName(shoppingCartItem.getName());</span><br><span class="line">        orderDetail.setImage(shoppingCartItem.getImage());</span><br><span class="line">        orderDetail.setOrderId(orderNum);</span><br><span class="line">        orderDetail.setDishId(shoppingCartItem.getDishId());</span><br><span class="line">        orderDetail.setSetmealId(shoppingCartItem.getSetmealId());</span><br><span class="line">        orderDetail.setDishFlavor(shoppingCartItem.getDishFlavor());</span><br><span class="line">        orderDetail.setNumber(shoppingCartItem.getNumber());</span><br><span class="line">        orderDetail.setAmount(shoppingCartItem.getAmount());</span><br><span class="line">        amountSum.add(shoppingCartItem.getAmount().doubleValue() * shoppingCartItem.getNumber());</span><br><span class="line">        <span class="keyword">return</span> orderDetail;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">orderDetailSaveOKFlag</span> <span class="operator">=</span> orderDetailService.saveBatch(orderDetailList);</span><br><span class="line">    <span class="comment">//插入数据到订单表</span></span><br><span class="line">    orders.setId(orderNum);</span><br><span class="line">    orders.setNumber(orderNum+<span class="string">&quot;&quot;</span>);</span><br><span class="line">    orders.setStatus(<span class="number">2</span>);</span><br><span class="line">    orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">    orders.setCheckoutTime(LocalDateTime.now());</span><br><span class="line">    orders.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(amountSum.doubleValue()));</span><br><span class="line">    orders.setPhone(user.getPhone());</span><br><span class="line">    orders.setAddress(addressBook.getDetail());</span><br><span class="line">    orders.setUserName(user.getName());</span><br><span class="line">    orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">ordersSaveOkFlag</span> <span class="operator">=</span> <span class="built_in">this</span>.save(orders);</span><br><span class="line">    <span class="comment">//校验是否保存成功</span></span><br><span class="line">    <span class="keyword">if</span>(ordersSaveOkFlag&amp;&amp;orderDetailSaveOKFlag)&#123;</span><br><span class="line">        <span class="comment">//保存成功清空购物车</span></span><br><span class="line">        shoppingCartService.remove(shoppingCartQW);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;保存失败，请稍后再试&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="40-订单分页查询（用户）"><a href="#40-订单分页查询（用户）" class="headerlink" title="40. 订单分页查询（用户）"></a>40. 订单分页查询（用户）</h3><h4 id="需求分析-28"><a href="#需求分析-28" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据，并获取session中的user和当前选择地址添加到对象中</li>
<li>添加查询条件（这个地方写好是因为网页端的订单管理也会访问所以写了一个通用的service）</li>
<li>分页查询订单列表补全ordersDto信息</li>
<li>将订单明细集合添加到ordersDto集合中</li>
<li>将ordersDto集合放入pageInfoOrdersDto集合</li>
<li>封装对象R&lt;List&lt;Page<OrodersDto>&gt;&gt;返回前端<br>注：这个地方个人觉得其实使用mapper.xml更好，这样循环太多会查很多次数据库，为了练习mp才这样写的</li>
</ol>
<h4 id="业务逻辑代码-36"><a href="#业务逻辑代码-36" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;OrdersDto&gt; <span class="title function_">selectPage</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pagesize, OrdersDto ordersDto)</span> &#123;</span><br><span class="line">    Page&lt;Orders&gt; pageInfoOrders = <span class="keyword">new</span> <span class="title class_">Page</span>(page,pagesize);</span><br><span class="line">    Page&lt;OrdersDto&gt; pageInfoOrdersDto = <span class="keyword">new</span> <span class="title class_">Page</span>(page,pagesize);</span><br><span class="line">    <span class="comment">//分页查询列表Orders</span></span><br><span class="line">    LambdaQueryWrapper&lt;Orders&gt; ordersDtoLambdaQW = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    ordersDtoLambdaQW.eq(ordersDto.getUserId() != <span class="literal">null</span>,Orders::getUserId,ordersDto.getUserId());</span><br><span class="line">    ordersDtoLambdaQW.like(StringUtils.isNotEmpty(ordersDto.getNumber()),Orders::getNumber,ordersDto.getNumber());</span><br><span class="line">    ordersDtoLambdaQW.ge(ordersDto.getBeginTime()!=<span class="literal">null</span>,Orders::getOrderTime,ordersDto.getBeginTime());</span><br><span class="line">    ordersDtoLambdaQW.le(ordersDto.getEndTime()!=<span class="literal">null</span>,Orders::getOrderTime,ordersDto.getEndTime());</span><br><span class="line">    ordersDtoLambdaQW.orderByDesc(Orders::getOrderTime);</span><br><span class="line">    ordersMapper.selectPage(pageInfoOrders, ordersDtoLambdaQW);</span><br><span class="line">    <span class="comment">//pageInfoOrders赋值pageInfoOrdersDto</span></span><br><span class="line">    BeanUtils.copyProperties(pageInfoOrders,pageInfoOrdersDto);</span><br><span class="line">    List&lt;Orders&gt; ordersList = pageInfoOrders.getRecords();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将ordersList赋值到ordersDtoList</span></span><br><span class="line">    List&lt;OrdersDto&gt; ordersDtoList = ordersList.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">OrdersDto</span> <span class="variable">ordersDtoTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(item,ordersDtoTemp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取地址簿信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;AddressBook&gt; addressBookQW = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">        addressBookQW.eq(AddressBook::getId,item.getAddressBookId());</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getOne(addressBookQW);</span><br><span class="line">        <span class="keyword">if</span>(addressBook == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前地址错误，请添加后再试&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取购物车信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; shoppingCartQW = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">        <span class="comment">//根据当前登录用户获取购物车信息</span></span><br><span class="line">        shoppingCartQW.eq(ShoppingCart::getUserId,item.getUserId());</span><br><span class="line">        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartService.list(shoppingCartQW);</span><br><span class="line">        <span class="keyword">if</span>(shoppingCartList == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前购物车信息有误，请检查后再试&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(item.getUserId());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置订单明细集合</span></span><br><span class="line">        LambdaQueryWrapper&lt;OrderDetail&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">        qw.eq(OrderDetail::getOrderId,item.getId());</span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailList = orderDetailService.list(qw);</span><br><span class="line">        ordersDtoTemp.setOrderDetails(orderDetailList);</span><br><span class="line">        <span class="comment">//设置用户名</span></span><br><span class="line">        ordersDtoTemp.setUserName(user.getName());</span><br><span class="line">        <span class="comment">//设置电话</span></span><br><span class="line">        ordersDtoTemp.setPhone(user.getPhone());</span><br><span class="line">        <span class="comment">//设置地址</span></span><br><span class="line">        ordersDtoTemp.setAddress(addressBook.getDetail());</span><br><span class="line">        <span class="comment">//设置收货人</span></span><br><span class="line">        ordersDtoTemp.setConsignee(addressBook.getConsignee());</span><br><span class="line">        <span class="keyword">return</span> ordersDtoTemp;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    pageInfoOrdersDto.setRecords(ordersDtoList);</span><br><span class="line">    <span class="keyword">return</span> pageInfoOrdersDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="41-订单管理分页查询（后台管理端）"><a href="#41-订单管理分页查询（后台管理端）" class="headerlink" title="41. 订单管理分页查询（后台管理端）"></a>41. 订单管理分页查询（后台管理端）</h3><h4 id="需求分析-29"><a href="#需求分析-29" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据</li>
<li>创建对象OrdersDto，并封装前端传输的查询数据（这个地方时间可以用String接收，但是要注意转换的时候需要先判断是否为空，如果不加判断用户未输入时间会报错）</li>
<li>调用订单管理分页查询service</li>
<li>封装对象R返回给前端</li>
</ol>
<h4 id="业务逻辑代码-37"><a href="#业务逻辑代码-37" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取订单分页信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&lt;OrdersDto&gt;&gt; <span class="title function_">selectPage</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String number, String beginTime, String endTime, HttpSession session)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;订单分页查询接收到的前端数据为:page:&#123;&#125;,pageSize&#123;&#125;,,OrdersDto&#123;&#125;&quot;</span>, page, pageSize);</span><br><span class="line">    <span class="type">OrdersDto</span> <span class="variable">ordersDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersDto</span>();</span><br><span class="line">    ordersDto.setNumber(number);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotEmpty(beginTime) &amp;&amp; StringUtils.isNotEmpty(endTime)) &#123;</span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        ordersDto.setBeginTime(LocalDateTime.parse(beginTime, formatter));</span><br><span class="line">        ordersDto.setEndTime(LocalDateTime.parse(endTime, formatter));</span><br><span class="line">    &#125;</span><br><span class="line">    Page&lt;OrdersDto&gt; ordersDtoPage = ordersService.selectPage(page, pageSize, ordersDto);</span><br><span class="line">    <span class="keyword">return</span> R.success(ordersDtoPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="42-修改订单状态（后台管理端）"><a href="#42-修改订单状态（后台管理端）" class="headerlink" title="42. 修改订单状态（后台管理端）"></a>42. 修改订单状态（后台管理端）</h3><h4 id="需求分析-30"><a href="#需求分析-30" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据</li>
<li>根据id修改状态</li>
<li>返回数据给前端</li>
</ol>
<h4 id="业务逻辑代码-38"><a href="#业务逻辑代码-38" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改订单状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping()</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">updateOrderStatus</span><span class="params">(<span class="meta">@RequestBody</span> Orders orders)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;更新订单状态接收到的前端数据为Orders:&#123;&#125;&quot;</span>,orders);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> ordersService.updateById(orders);</span><br><span class="line">    <span class="keyword">return</span> flag?R.success(<span class="string">&quot;更新订单状态，修改成功！&quot;</span>):R.error(<span class="string">&quot;修改失败，请再试一次~&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="43-订单历史查询-再来一单"><a href="#43-订单历史查询-再来一单" class="headerlink" title="43. 订单历史查询-再来一单"></a>43. 订单历史查询-再来一单</h3><h4 id="需求分析-31"><a href="#需求分析-31" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>接收前端数据，并获取session中的user和当前选择地址添加到对象中</li>
<li>根据订单id查询订单集合</li>
<li>将订单集合copy到购物车集合</li>
<li>保存购物车集合到数据库</li>
<li>封装对象R返回前端</li>
</ol>
<h4 id="业务逻辑代码-39"><a href="#业务逻辑代码-39" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">again</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;OrderDetail&gt; qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    qw.eq(OrderDetail::getOrderId,orders.getId());</span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList = orderDetailService.list(qw);</span><br><span class="line">    <span class="comment">//获取用户id，</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> orders.getUserId();</span><br><span class="line">    List&lt;ShoppingCart&gt; shoppingCarts = orderDetailList.stream().map((item) -&gt;&#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        <span class="comment">//Copy对应属性值</span></span><br><span class="line">        BeanUtils.copyProperties(item,shoppingCart);</span><br><span class="line">        <span class="comment">//设置一下userId</span></span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line">        <span class="comment">//设置一下创建时间为当前时间</span></span><br><span class="line">        shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">        <span class="keyword">return</span> shoppingCart;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//加入购物车</span></span><br><span class="line">    shoppingCartService.saveBatch(shoppingCarts);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-手机端退出登录"><a href="#45-手机端退出登录" class="headerlink" title="45. 手机端退出登录"></a>45. 手机端退出登录</h3><h4 id="需求分析-32"><a href="#需求分析-32" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>获取前端数据</li>
<li>从Session中找到当前用户并删除</li>
<li>封装对象R返回前端</li>
</ol>
<h4 id="业务逻辑代码-40"><a href="#业务逻辑代码-40" class="headerlink" title="业务逻辑代码"></a>业务逻辑代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/loginout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">loginout</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;退出登录功能&quot;</span>);</span><br><span class="line">    session.removeAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;退出登录成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="项目部署到腾讯云服务器"><a href="#项目部署到腾讯云服务器" class="headerlink" title="项目部署到腾讯云服务器"></a>项目部署到腾讯云服务器</h2><h4 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h4><ol>
<li>修改pom.xml文件如下（初始创建的pom文件打成jar包有问题，可以直接复制这一段）<br>pom.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.gigottakeaway<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>GigotTakeaway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>GigotTakeaway<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.6.13<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--腾讯云SMS--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tencentcloudapi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tencentcloud-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- go to https://search.maven.org/search?q=tencentcloud-sdk-java and get the latest version. --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请到https://search.maven.org/search?q=tencentcloud-sdk-java查询所有版本，最新版本如下 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.764<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Eamil--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.activation/activation --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.mail/mail --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.mail<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-email --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-email<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--随机用户名生成工具类--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Guava --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>30.1-jre<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.gigottakeaway.GigotTakeawayApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>增加系统入口业务层，用于区分手机访问和pc访问，且可以直接通过地址:端口的形式访问（该项目端口为80所以直接通过路径就可以访问了）不需要静态页面路径，这个地方需要把”&#x2F;“这个路径添加到拦截器放行里面，不然会被拦截器拦截<br>EntryController<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.view.RedirectView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 程序入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EntryController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping()</span></span><br><span class="line">    <span class="keyword">public</span> RedirectView <span class="title function_">entry</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userAgent</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;User-Agent&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (userAgent != <span class="literal">null</span> &amp;&amp; userAgent.contains(<span class="string">&quot;Mobile&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 用户使用的是手机设备</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RedirectView</span>(<span class="string">&quot;/front/index.html&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 用户使用的是电脑设备</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RedirectView</span>(<span class="string">&quot;/backend/index.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
LoginCheckFilter</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.common.R;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.util.BaseContextUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.AntPathMatcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查用户是否完成登录，登录后放行资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="comment">//路径匹配器，支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        log.info(<span class="string">&quot;当前拦截到的请求：&#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class="line">        <span class="comment">//定义排除登录相关功能地址和静态资源相关地址</span></span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/user/sendMsg&quot;</span>, <span class="comment">//移动端发送短信</span></span><br><span class="line">                <span class="string">&quot;/user/login&quot;</span>,<span class="comment">//移动端登录</span></span><br><span class="line">                <span class="string">&quot;/&quot;</span> <span class="comment">// 程序入口</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//判断本次请求是否在上面需要排除的地址中,如果在放行</span></span><br><span class="line">        <span class="keyword">if</span>(check(urls,request.getRequestURI()))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;用户访问登录或相关静态资源地址放行资源&quot;</span>);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断用户是否已登录，已登录放行</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;&#123;&#125;已登录，放行资源&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            <span class="type">Long</span> <span class="variable">idSession</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">            BaseContextUtils.setThreadLocal(idSession);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断手机端用户是否登录</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long)request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            BaseContextUtils.setThreadLocal(userId);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//前端需求代码中有拦截器，因此这这儿使用输出流的方式传给前端一个R封装对象</span></span><br><span class="line">        log.info(<span class="string">&quot;用户未登录返回前台，前端进行地址跳转&quot;</span>);</span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 路径匹配，用于排除登录相关资源的校验方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls,String requestUri)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="comment">//PATH_MATCHER.match(url,requestUri)方法，用于判断两个地址是否匹配，并且支持通配符的格式，如果匹配商返回true，否则返回false</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> PATH_MATCHER.match(url,requestUri);</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>增加短信验证码发送频率校验10分钟一次（因为挂了短信，防止恶意攻击把短信包给用完了）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gigottakeaway.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.common.R;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.exception.CustomException;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.gigottakeaway.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;短信验证码发送功能接收到的前端参数为：user:&#123;&#125;,session:&#123;&#125;&quot;</span>,user,session);</span><br><span class="line">        <span class="comment">// 获取当前时间</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">currentTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查验证码发送时间</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">lastSentTime</span> <span class="operator">=</span> (LocalDateTime) session.getAttribute(<span class="string">&quot;lastSentTime&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (lastSentTime != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(lastSentTime, currentTime);</span><br><span class="line">            <span class="type">long</span> <span class="variable">minutes</span> <span class="operator">=</span> duration.toMinutes();</span><br><span class="line">            <span class="keyword">if</span> (minutes &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;验证码发送时间不足10分钟，请稍后再试&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        userService.sendMsg(user, session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新验证码发送时间</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;lastSentTime&quot;</span>, currentTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;成功发送短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">loginByCode</span><span class="params">(<span class="meta">@RequestBody</span> Map map,HttpSession session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;登录功能接收到的前端参数为：map:&#123;&#125;,session:&#123;&#125;&quot;</span>,map.toString(),session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取当前时间</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">currentTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查验证码发送时间</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">sentTime</span> <span class="operator">=</span> (LocalDateTime) session.getAttribute(<span class="string">&quot;lastSentTime&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (sentTime != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(sentTime, currentTime);</span><br><span class="line">            <span class="type">long</span> <span class="variable">minutes</span> <span class="operator">=</span> duration.toMinutes();</span><br><span class="line">            <span class="keyword">if</span> (minutes &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="comment">// 验证码已过期</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;验证码已过期，请重新获取&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 验证码不存在或未发送</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;验证码不存在或未发送&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> userService.loginByCode(map,session);</span><br><span class="line">        <span class="keyword">return</span> flag?R.success(<span class="string">&quot;登录成功&quot;</span>):R.error(<span class="string">&quot;登录失败，请再试一次&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loginout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">loginout</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;退出登录功能&quot;</span>);</span><br><span class="line">        session.removeAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;退出登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><ol>
<li>application.yml区分开发环境和正式环境</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#开发环境</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gigot_takeaway</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">开发数据库地址</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">用户名</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">密码</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br><span class="line"><span class="attr">employee:</span></span><br><span class="line">  <span class="comment">#默认密码</span></span><br><span class="line">  <span class="attr">defalutPassword:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="attr">takeout:</span></span><br><span class="line">  <span class="comment">#上传文件存储地址</span></span><br><span class="line">  <span class="attr">filePath:</span> <span class="string">&quot;src/main/resources/upload/&quot;</span></span><br><span class="line">  <span class="comment">#后门 用于绕过短信登录</span></span><br><span class="line">  <span class="attr">developerUsername:</span> <span class="string">用户名</span></span><br><span class="line">  <span class="attr">developerPassword:</span> <span class="string">密码</span></span><br><span class="line">  <span class="attr">startProfile:</span> <span class="string">&quot;开发&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#正式环境</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">prod</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gigot_takeaway</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">正式数据库地址</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">用户名</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">密码</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br><span class="line"><span class="attr">employee:</span></span><br><span class="line">  <span class="comment">#默认密码</span></span><br><span class="line">  <span class="attr">defalutPassword:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="attr">takeout:</span></span><br><span class="line">  <span class="comment">#上传文件存储地址</span></span><br><span class="line">  <span class="attr">filePath:</span> <span class="string">&quot;upload/&quot;</span></span><br><span class="line">  <span class="comment">#后门 用于绕过短信登录</span></span><br><span class="line">  <span class="attr">developerUsername:</span> <span class="string">用户名</span></span><br><span class="line">  <span class="attr">developerPassword:</span> <span class="string">密码</span></span><br><span class="line">  <span class="attr">startProfile:</span> <span class="string">&quot;正式&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="Bug修改"><a href="#Bug修改" class="headerlink" title="Bug修改"></a>Bug修改</h4><ol>
<li>AddressBookController增加校验获取地址为空向前端抛出业务异常，需要让用户增加地址（文档代码已更新，此问题解决）</li>
<li>手机端登录输入正确的验证码确提示验证码错误，经排查发现是存储“检查验证码发送时间”的session名称错了，改一下名称就好（文档代码已更新，此问题解决）</li>
<li>打包后程序没有主入口（pom.xml文件里面有<skip>表现，先时注释了，但是注释没生效，后来删除掉就好了）</li>
<li>初次启动服务时因为Linux没有一些字体包，会自动下载，第一次访问时间较长（问题待以后前端解决）</li>
</ol>
<h4 id="部署到腾讯云服务器（使用宝塔运维工具）"><a href="#部署到腾讯云服务器（使用宝塔运维工具）" class="headerlink" title="部署到腾讯云服务器（使用宝塔运维工具）"></a>部署到腾讯云服务器（使用宝塔运维工具）</h4><ol>
<li><p>打包程序为jar包</p>
</li>
<li><p>可以使用navicat的数据库同步到服务器，我这儿服务器上的版本比较低，就直接重新建表了<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/efb10c1efda94e7782fd4323bc495a1b.png" alt="在这里插入图片描述"></p>
</li>
<li><p>上传文件到服务器<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/a7bf514b85c247a783824db7267c357e.png" alt="在这里插入图片描述"></p>
</li>
<li><p>配置网站<br>注：如果需要配置域名的话在【域名管理】中配置，并在【外网映射】中开启外网映射<br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/24f8ef532da24f72a731250e3eb966c5.png" alt="在这里插入图片描述"></p>
</li>
<li><p>测试<br><em><strong>后台管理端</strong></em><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/d6c17e547a5a443b90faba2ce3df00c3.png" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/53b4aa20818746c4ad9d360314ec048d.png" alt="在这里插入图片描述"></p>
</li>
</ol>
<p><em><strong>客户端</strong></em><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/0eec08f12bbd43f1baf9e30bca1eda10.png"><br><em><strong>短信&#x2F;邮箱验证码</strong></em><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/4093522c264548c383ca3a4e368478c6.png" alt="在这里插入图片描述"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/PanYW-Git/picture/raw/master/img/c3a5ed7a1c9f4006bf468132bf0a6ebe.png" alt="在这里插入图片描述"></p>
<h1 id="完结撒花"><a href="#完结撒花" class="headerlink" title="完结撒花"></a>完结撒花</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://PanYW-Git.github.io">PanYW</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://panyw-git.github.io/2023/05/15/%E7%BE%8A%E8%85%BF%E5%A4%96%E5%8D%96%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/">https://panyw-git.github.io/2023/05/15/羊腿外卖开发记录/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://PanYW-Git.github.io" target="_blank">PanYw's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mybatis-plus/">mybatis-plus</a><a class="post-meta__tags" href="/tags/springboot/">springboot</a><a class="post-meta__tags" href="/tags/mysql/">mysql</a><a class="post-meta__tags" href="/tags/vue2/">vue2</a><a class="post-meta__tags" href="/tags/ajax/">ajax</a></div><div class="post_share"><div class="social-share" data-image="/images/touxiang.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="JAVA基础复习-全代码"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JAVA基础复习-全代码</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/10/%E5%B8%B8%E7%94%A8DOS%E5%91%BD%E4%BB%A4/" title="常用DOS命令（持续更新）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">常用DOS命令（持续更新）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/18/%E4%BD%BF%E7%94%A8mybatis-plus%E5%A4%84%E7%90%86update%E4%B8%9A%E5%8A%A1%E5%B9%B6%E5%8F%91/" title="使用mybatis-plus处理update业务并发情况"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-18</div><div class="title">使用mybatis-plus处理update业务并发情况</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">PanYW</div><div class="author-info__description">但行好事，莫问前程</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%99%E5%AD%A6%E5%9C%B0%E5%9D%80"><span class="toc-number">1.</span> <span class="toc-text">教学地址</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%AC%A1%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84%E6%8A%80%E6%9C%AF"><span class="toc-number">2.</span> <span class="toc-text">本次项目中使用到的技术</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%89%8D%E8%A8%80%EF%BC%88%E6%94%BE%E5%9C%A8%E8%BF%99%E5%84%BF%EF%BC%81%E5%BF%85%E7%9C%8B%EF%BC%81%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">项目前言（放在这儿！必看！）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">项目总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E7%82%B9%E5%B0%8F%E6%83%8A%E5%96%9C"><span class="toc-number">5.</span> <span class="toc-text">一点小惊喜</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95"><span class="toc-number">6.</span> <span class="toc-text">项目开发记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">6.1.</span> <span class="toc-text">一、准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.</span> <span class="toc-text">二、后台系统登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-number">6.2.1.</span> <span class="toc-text">1. 用户登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%88%86%E6%9E%90"><span class="toc-number">6.2.1.3.</span> <span class="toc-text">登录功能前端页面分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.2.</span> <span class="toc-text">2. 退出登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-1"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-1"><span class="toc-number">6.2.2.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%99%BB%E5%BD%95%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">6.2.3.</span> <span class="toc-text">3. 登录拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-2"><span class="toc-number">6.2.3.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-2"><span class="toc-number">6.2.3.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5"><span class="toc-number">6.2.4.</span> <span class="toc-text">4. 新增员工</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-3"><span class="toc-number">6.2.4.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-3"><span class="toc-number">6.2.4.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">6.2.5.</span> <span class="toc-text">5. 全局异常处理器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%90%8D%E9%87%8D%E5%A4%8D%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86"><span class="toc-number">6.2.5.1.</span> <span class="toc-text">用户名重复报错处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.6.</span> <span class="toc-text">6. 员工信息分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-4"><span class="toc-number">6.2.6.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-4"><span class="toc-number">6.2.6.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">6.2.6.3.</span> <span class="toc-text">测试类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-number">6.2.6.4.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%91%98%E5%B7%A5%E8%B4%A6%E5%8F%B7%E7%A6%81%E7%94%A8%E3%80%81%E5%90%AF%E7%94%A8"><span class="toc-number">6.2.7.</span> <span class="toc-text">7. 员工账号禁用、启用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-5"><span class="toc-number">6.2.7.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-5"><span class="toc-number">6.2.7.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%EF%BC%88%E9%9D%9E%E5%B8%B8%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%89"><span class="toc-number">6.2.7.3.</span> <span class="toc-text">解决问题记录（非常非常重要！！！）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%BF%AE%E6%94%B9%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">6.2.8.</span> <span class="toc-text">8. 修改员工信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-6"><span class="toc-number">6.2.8.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-6"><span class="toc-number">6.2.8.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-number">6.2.9.</span> <span class="toc-text">9. 公共字段自动填充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-7"><span class="toc-number">6.2.9.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-7"><span class="toc-number">6.2.9.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-1"><span class="toc-number">6.2.9.3.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.10.</span> <span class="toc-text">10. 分类管理新增功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">6.2.10.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-8"><span class="toc-number">6.2.10.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.11.</span> <span class="toc-text">11. 分类管理分页查询功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="toc-number">6.2.11.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-9"><span class="toc-number">6.2.11.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.12.</span> <span class="toc-text">12. 分类管理删除功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="toc-number">6.2.12.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-10"><span class="toc-number">6.2.12.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-2"><span class="toc-number">6.2.12.3.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E4%BF%AE%E6%94%B9%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.13.</span> <span class="toc-text">13. 分类管理修改功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-8"><span class="toc-number">6.2.13.1.</span> <span class="toc-text">功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-11"><span class="toc-number">6.2.13.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">6.2.14.</span> <span class="toc-text">14. 文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="toc-number">6.2.14.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-12"><span class="toc-number">6.2.14.1.1.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-3"><span class="toc-number">6.2.14.2.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">6.2.15.</span> <span class="toc-text">15. 文件下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-4"><span class="toc-number">6.2.15.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-13"><span class="toc-number">6.2.15.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.16.</span> <span class="toc-text">16. 菜品管理分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-5"><span class="toc-number">6.2.16.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-14"><span class="toc-number">6.2.16.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-4"><span class="toc-number">6.2.16.3.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.17.</span> <span class="toc-text">17. 菜品管理保存数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-6"><span class="toc-number">6.2.17.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-15"><span class="toc-number">6.2.17.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.18.</span> <span class="toc-text">18. 菜品管理修改数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-7"><span class="toc-number">6.2.18.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-16"><span class="toc-number">6.2.18.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-%E6%89%B9%E9%87%8F%E8%B5%B7%E5%94%AE%E3%80%81%E6%89%B9%E9%87%8F%E5%81%9C%E5%94%AE"><span class="toc-number">6.2.19.</span> <span class="toc-text">19. 批量起售、批量停售</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-8"><span class="toc-number">6.2.19.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-17"><span class="toc-number">6.2.19.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E8%AE%B0%E5%BD%95"><span class="toc-number">6.2.19.3.</span> <span class="toc-text">问题解决记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">6.2.20.</span> <span class="toc-text">20. 批量删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-9"><span class="toc-number">6.2.20.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-18"><span class="toc-number">6.2.20.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.21.</span> <span class="toc-text">21. 套餐管理分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-10"><span class="toc-number">6.2.21.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-19"><span class="toc-number">6.2.21.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.22.</span> <span class="toc-text">22. 套餐管理保存数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-11"><span class="toc-number">6.2.22.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-20"><span class="toc-number">6.2.22.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.23.</span> <span class="toc-text">23. 套餐管理修改数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-12"><span class="toc-number">6.2.23.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-21"><span class="toc-number">6.2.23.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E6%89%B9%E9%87%8F%E5%81%9C%E5%94%AE%EF%BC%8C%E5%90%AF%E5%94%AE"><span class="toc-number">6.2.24.</span> <span class="toc-text">24. 套餐管理批量停售，启售</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-13"><span class="toc-number">6.2.24.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-22"><span class="toc-number">6.2.24.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-5"><span class="toc-number">6.2.24.3.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">6.2.25.</span> <span class="toc-text">25. 套餐管理批量删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-14"><span class="toc-number">6.2.25.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-23"><span class="toc-number">6.2.25.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#26-%E6%89%8B%E6%9C%BA%E7%AB%AF%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-number">6.2.26.</span> <span class="toc-text">26. 手机端短信验证码登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-15"><span class="toc-number">6.2.26.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-24"><span class="toc-number">6.2.26.2.</span> <span class="toc-text">业务逻辑代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95-6"><span class="toc-number">6.2.26.3.</span> <span class="toc-text">解决问题记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E6%9F%A5%E8%AF%A2%E5%88%97%E8%A1%A8"><span class="toc-number">6.2.27.</span> <span class="toc-text">27. 地址管理查询列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-16"><span class="toc-number">6.2.27.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-25"><span class="toc-number">6.2.27.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#28-%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.28.</span> <span class="toc-text">28. 地址管理修改数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-26"><span class="toc-number">6.2.28.1.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">6.2.29.</span> <span class="toc-text">29. 地址管理修改默认地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-17"><span class="toc-number">6.2.29.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-27"><span class="toc-number">6.2.29.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30-%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%88%A0%E9%99%A4"><span class="toc-number">6.2.30.</span> <span class="toc-text">30. 地址管理删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-18"><span class="toc-number">6.2.30.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82%E4%BB%A3%E7%A0%81"><span class="toc-number">6.2.30.2.</span> <span class="toc-text">业务需求代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E6%89%8B%E6%9C%BA%E7%AB%AF%E4%B8%BB%E9%A1%B5%E6%98%BE%E7%A4%BA"><span class="toc-number">6.2.31.</span> <span class="toc-text">31.手机端主页显示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-19"><span class="toc-number">6.2.31.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-28"><span class="toc-number">6.2.31.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E6%9F%A5%E8%AF%A2%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8"><span class="toc-number">6.2.32.</span> <span class="toc-text">32. 查询购物车列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-20"><span class="toc-number">6.2.32.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-29"><span class="toc-number">6.2.32.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">6.2.33.</span> <span class="toc-text">33. 添加购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-21"><span class="toc-number">6.2.33.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-30"><span class="toc-number">6.2.33.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E5%87%8F%E5%B0%91%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">6.2.34.</span> <span class="toc-text">34. 减少购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-22"><span class="toc-number">6.2.34.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-31"><span class="toc-number">6.2.34.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">6.2.35.</span> <span class="toc-text">35. 清空购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-23"><span class="toc-number">6.2.35.1.</span> <span class="toc-text">需求分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%E8%8E%B7%E5%8F%96%E9%BB%98%E8%AE%A4%E8%AE%A2%E5%8D%95%E5%9C%B0%E5%9D%80"><span class="toc-number">6.2.36.</span> <span class="toc-text">36. 获取默认订单地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-24"><span class="toc-number">6.2.36.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-32"><span class="toc-number">6.2.36.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-%E4%BF%AE%E6%94%B9%E8%AE%A2%E5%8D%95%E5%9C%B0%E5%9D%80"><span class="toc-number">6.2.37.</span> <span class="toc-text">37. 修改订单地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-25"><span class="toc-number">6.2.37.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-33"><span class="toc-number">6.2.37.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-%E6%89%8B%E6%9C%BA%E7%AB%AF%E4%B8%BB%E9%A1%B5%E7%82%B9%E5%87%BB%E5%A5%97%E9%A4%90%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E5%A5%97%E9%A4%90%E8%AF%A6%E6%83%85"><span class="toc-number">6.2.38.</span> <span class="toc-text">38. 手机端主页点击套餐图片显示套餐详情</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-26"><span class="toc-number">6.2.38.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-34"><span class="toc-number">6.2.38.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#39-%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95"><span class="toc-number">6.2.39.</span> <span class="toc-text">39. 用户下单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-27"><span class="toc-number">6.2.39.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-35"><span class="toc-number">6.2.39.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#40-%E8%AE%A2%E5%8D%95%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%EF%BC%88%E7%94%A8%E6%88%B7%EF%BC%89"><span class="toc-number">6.2.40.</span> <span class="toc-text">40. 订单分页查询（用户）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-28"><span class="toc-number">6.2.40.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-36"><span class="toc-number">6.2.40.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%AB%AF%EF%BC%89"><span class="toc-number">6.2.41.</span> <span class="toc-text">41. 订单管理分页查询（后台管理端）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-29"><span class="toc-number">6.2.41.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-37"><span class="toc-number">6.2.41.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E4%BF%AE%E6%94%B9%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%EF%BC%88%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%AB%AF%EF%BC%89"><span class="toc-number">6.2.42.</span> <span class="toc-text">42. 修改订单状态（后台管理端）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-30"><span class="toc-number">6.2.42.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-38"><span class="toc-number">6.2.42.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E8%AE%A2%E5%8D%95%E5%8E%86%E5%8F%B2%E6%9F%A5%E8%AF%A2-%E5%86%8D%E6%9D%A5%E4%B8%80%E5%8D%95"><span class="toc-number">6.2.43.</span> <span class="toc-text">43. 订单历史查询-再来一单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-31"><span class="toc-number">6.2.43.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-39"><span class="toc-number">6.2.43.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%E6%89%8B%E6%9C%BA%E7%AB%AF%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">6.2.44.</span> <span class="toc-text">45. 手机端退出登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-32"><span class="toc-number">6.2.44.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81-40"><span class="toc-number">6.2.44.2.</span> <span class="toc-text">业务逻辑代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.3.</span> <span class="toc-text">项目部署到腾讯云服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="toc-number">6.3.0.1.</span> <span class="toc-text">代码修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.0.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bug%E4%BF%AE%E6%94%B9"><span class="toc-number">6.3.0.3.</span> <span class="toc-text">Bug修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%BD%BF%E7%94%A8%E5%AE%9D%E5%A1%94%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%EF%BC%89"><span class="toc-number">6.3.0.4.</span> <span class="toc-text">部署到腾讯云服务器（使用宝塔运维工具）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%8C%E7%BB%93%E6%92%92%E8%8A%B1"><span class="toc-number">7.</span> <span class="toc-text">完结撒花</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/18/%E4%BD%BF%E7%94%A8mybatis-plus%E5%A4%84%E7%90%86update%E4%B8%9A%E5%8A%A1%E5%B9%B6%E5%8F%91/" title="使用mybatis-plus处理update业务并发情况">使用mybatis-plus处理update业务并发情况</a><time datetime="2023-08-18T04:30:32.000Z" title="发表于 2023-08-18 12:30:32">2023-08-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/14/redis%E7%9A%84hash%E7%B1%BB%E5%9E%8Bvalue%E6%98%AF%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88java%E5%8F%AA%E8%83%BD%E5%AD%98%E5%85%A5String%E7%B1%BB%E5%9E%8B%EF%BC%9F/" title="redis的hash类型的value是支持多种数据类型的，为什么会只能存入String？">redis的hash类型的value是支持多种数据类型的，为什么会只能存入String？</a><time datetime="2023-08-14T04:24:32.000Z" title="发表于 2023-08-14 12:24:32">2023-08-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/11/%E7%BE%8A%E8%85%BF%E7%82%B9%E8%AF%84/" title="Redis项目实践-羊腿点评">Redis项目实践-羊腿点评</a><time datetime="2023-08-11T01:15:32.000Z" title="发表于 2023-08-11 09:15:32">2023-08-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="JAVA基础复习-全代码">JAVA基础复习-全代码</a><time datetime="2023-06-10T01:15:32.000Z" title="发表于 2023-06-10 09:15:32">2023-06-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/15/%E7%BE%8A%E8%85%BF%E5%A4%96%E5%8D%96%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/" title="羊腿外卖开发记录">羊腿外卖开发记录</a><time datetime="2023-05-15T01:15:32.000Z" title="发表于 2023-05-15 09:15:32">2023-05-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By PanYW</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'Iv1.994228eb17287ed8',
      clientSecret: 'b9a22431d7a87eb921b42cef4ccfb958dab65b62',
      repo: 'panyw-git.github.io',
      owner: 'PanYW-Git',
      admin: ['PanYW-Git'],
      id: '178b891390fc0b1a76ad89c5d3ceb552',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>